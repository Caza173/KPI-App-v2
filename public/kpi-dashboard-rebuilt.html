<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPI Dashboard - Rebuilt</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --bg-color: #ffffff;
            --text-color: #000000;
            --card-bg: #ffffff;
            --border-color: #dee2e6;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --card-bg: #2d2d2d;
            --border-color: #404040;
            --shadow: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 2px 10px var(--shadow);
            border: 1px solid var(--border-color);
        }

        .header h1 {
            color: var(--primary-color);
            font-size: 2rem;
            font-weight: 600;
        }

        .theme-toggle {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            opacity: 0.8;
        }

        .tabs {
            display: flex;
            background: var(--card-bg);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            box-shadow: 0 2px 10px var(--shadow);
            border: 1px solid var(--border-color);
        }

        .tab {
            background: transparent;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-color);
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .tab:hover {
            background: var(--light-color);
        }

        .tab.active {
            background: var(--primary-color);
            color: white;
        }

        .tab-content {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px var(--shadow);
            border: 1px solid var(--border-color);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-color);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 14px;
            background: var(--bg-color);
            color: var(--text-color);
        }

        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            opacity: 0.8;
        }

        .btn-danger {
            background: var(--danger-color);
        }

        .btn-success {
            background: var(--success-color);
        }

        .btn-warning {
            background: var(--warning-color);
        }

        .progress-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .progress-wheel {
            text-align: center;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 2px 10px var(--shadow);
            border: 1px solid var(--border-color);
        }

        .wheel {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px;
            position: relative;
        }

        .wheel-background,
        .wheel-progress {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: absolute;
            top: 0;
            left: 0;
        }

        .wheel-background {
            background: conic-gradient(#e9ecef 0deg, #e9ecef 360deg);
        }

        .wheel-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            font-weight: bold;
            color: var(--text-color);
        }

        .wheel-label {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-color);
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px var(--shadow);
            border: 1px solid var(--border-color);
        }

        .card h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .table th {
            background: var(--light-color);
            font-weight: 600;
            color: var(--text-color);
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-closed {
            background: #d4edda;
            color: #155724;
        }

        .status-active {
            background: #cce5ff;
            color: #004085;
        }

        [data-theme="dark"] .status-pending {
            background: #533f03;
            color: #ffc107;
        }

        [data-theme="dark"] .status-closed {
            background: #0f3a1a;
            color: #28a745;
        }

        [data-theme="dark"] .status-active {
            background: #032b52;
            color: #17a2b8;
        }

        .date-picker {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .metric-card {
            text-align: center;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 2px 10px var(--shadow);
            border: 1px solid var(--border-color);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 14px;
            color: var(--secondary-color);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .calculator-result {
            background: var(--success-color);
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }

        .reset-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        [data-theme="dark"] .reset-section {
            background: #533f03;
            border-color: #ffc107;
        }

        .reset-warning {
            color: #856404;
            font-weight: 500;
            margin-bottom: 15px;
        }

        [data-theme="dark"] .reset-warning {
            color: #ffc107;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .tabs {
                overflow-x: auto;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .data-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const ProgressWheel = ({ percentage, label, color = '#007bff' }) => {
            const clampedPercentage = Math.min(Math.max(percentage, 0), 100);
            
            const getColor = (percentage) => {
                if (percentage >= 80) return '#28a745';
                if (percentage >= 60) return '#ffc107';
                return '#dc3545';
            };

            const displayColor = color === '#007bff' ? getColor(clampedPercentage) : color;
            const degrees = (clampedPercentage / 100) * 360;

            return (
                <div className="progress-wheel">
                    <div className="wheel">
                        <div className="wheel-background"></div>
                        <div 
                            className="wheel-progress"
                            style={{
                                background: `conic-gradient(${displayColor} 0deg, ${displayColor} ${degrees}deg, #e9ecef ${degrees}deg, #e9ecef 360deg)`
                            }}
                        ></div>
                        <div className="wheel-text">{clampedPercentage}%</div>
                    </div>
                    <div className="wheel-label">{label}</div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('goals');
            const [isDarkMode, setIsDarkMode] = useState(false);
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            
            const [goals, setGoals] = useState({
                dailyLeads: 0,
                dailyCalls: 0,
                dailyAppointments: 0,
                weeklyLeads: 0,
                weeklyCalls: 0,
                weeklyAppointments: 0
            });

            const [gciCalculator, setGciCalculator] = useState({
                salePrice: '',
                commission: '3',
                splits: '50'
            });

            const [dailyData, setDailyData] = useState({});
            const [properties, setProperties] = useState([]);
            const [transactions, setTransactions] = useState([]);
            const [expenses, setExpenses] = useState([]);

            useEffect(() => {
                document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
            }, [isDarkMode]);

            const addProperty = (propertyData) => {
                const newProperty = {
                    id: Date.now(),
                    ...propertyData,
                    status: 'Active',
                    dateAdded: new Date().toISOString().split('T')[0]
                };
                
                const newTransaction = {
                    id: Date.now() + 1,
                    propertyId: newProperty.id,
                    type: propertyData.listingType,
                    status: 'Pending',
                    dateCreated: new Date().toISOString().split('T')[0],
                    expectedCloseDate: propertyData.expectedCloseDate || '',
                    salePrice: propertyData.salePrice || 0
                };
                
                setProperties(prev => [...prev, newProperty]);
                setTransactions(prev => [...prev, newTransaction]);
            };

            const deleteProperty = (propertyId) => {
                setProperties(prev => prev.filter(p => p.id !== propertyId));
                setTransactions(prev => prev.filter(t => t.propertyId !== propertyId));
            };

            const updateTransactionStatus = (transactionId, newStatus) => {
                setTransactions(prev =>
                    prev.map(transaction => {
                        if (transaction.id === transactionId) {
                            const updatedTransaction = { ...transaction, status: newStatus };
                            if (newStatus === 'Closed') {
                                updatedTransaction.closedDate = new Date().toISOString().split('T')[0];
                            }
                            return updatedTransaction;
                        }
                        return transaction;
                    })
                );
            };

            const updatePropertyStatus = (propertyId, newStatus) => {
                setProperties(prev =>
                    prev.map(property =>
                        property.id === propertyId
                            ? { ...property, status: newStatus }
                            : property
                    )
                );
                
                if (newStatus === 'Sold' || newStatus === 'Closed') {
                    setTransactions(prev =>
                        prev.map(transaction =>
                            transaction.propertyId === propertyId
                                ? { ...transaction, status: 'Closed', closedDate: new Date().toISOString().split('T')[0] }
                                : transaction
                        )
                    );
                }
            };

            const addExpense = (expenseData) => {
                const newExpense = {
                    id: Date.now(),
                    ...expenseData,
                    date: new Date().toISOString().split('T')[0]
                };
                setExpenses(prev => [...prev, newExpense]);
            };

            const updateExpense = (expenseId, updatedData) => {
                setExpenses(prev =>
                    prev.map(expense =>
                        expense.id === expenseId
                            ? { ...expense, ...updatedData }
                            : expense
                    )
                );
            };

            const deleteExpense = (expenseId) => {
                setExpenses(prev => prev.filter(expense => expense.id !== expenseId));
            };

            const calculateEffectiveHourlyWage = () => {
                const closedTransactions = transactions.filter(t => t.status === 'Closed');
                const totalIncome = closedTransactions.reduce((sum, t) => sum + (parseFloat(t.salePrice) || 0), 0);
                
                const closedTransactionExpenses = expenses.filter(expense => {
                    const relatedTransaction = closedTransactions.find(t => t.propertyId === expense.propertyId);
                    return relatedTransaction !== undefined;
                });
                
                const totalExpenses = closedTransactionExpenses.reduce((sum, expense) => sum + (parseFloat(expense.amount) || 0), 0);
                const netIncome = totalIncome - totalExpenses;
                
                const totalHours = Object.values(dailyData).reduce((sum, day) => sum + (day.hoursWorked || 0), 0);
                
                return totalHours > 0 ? netIncome / totalHours : 0;
            };

            const masterReset = () => {
                if (window.confirm('Are you sure you want to reset ALL data? This action cannot be undone.')) {
                    setGoals({
                        dailyLeads: 0,
                        dailyCalls: 0,
                        dailyAppointments: 0,
                        weeklyLeads: 0,
                        weeklyCalls: 0,
                        weeklyAppointments: 0
                    });
                    setGciCalculator({
                        salePrice: '',
                        commission: '3',
                        splits: '50'
                    });
                    setDailyData({});
                    setProperties([]);
                    setTransactions([]);
                    setExpenses([]);
                    setSelectedDate(new Date().toISOString().split('T')[0]);
                    alert('All data has been reset successfully.');
                }
            };

            const updateDailyData = (date, field, value) => {
                setDailyData(prev => ({
                    ...prev,
                    [date]: {
                        ...prev[date],
                        [field]: parseFloat(value) || 0
                    }
                }));
            };

            const getDailyData = (date, field) => {
                return dailyData[date]?.[field] || 0;
            };

            const getWeekStart = (date) => {
                const d = new Date(date);
                const day = d.getDay();
                const diff = d.getDate() - day;
                return new Date(d.setDate(diff)).toISOString().split('T')[0];
            };

            const getWeeklyTotal = (field, targetDate = selectedDate) => {
                const weekStart = getWeekStart(targetDate);
                const weekData = Object.entries(dailyData).filter(([date]) => {
                    const dateObj = new Date(date);
                    const weekStartObj = new Date(weekStart);
                    const weekEndObj = new Date(weekStartObj);
                    weekEndObj.setDate(weekEndObj.getDate() + 6);
                    return dateObj >= weekStartObj && dateObj <= weekEndObj;
                });
                
                return weekData.reduce((sum, [, data]) => sum + (data[field] || 0), 0);
            };

            const getWeeklyProgress = (field, weeklyGoal, targetDate = selectedDate) => {
                const weeklyTotal = getWeeklyTotal(field, targetDate);
                return weeklyGoal > 0 ? Math.round((weeklyTotal / weeklyGoal) * 100) : 0;
            };

            const calculateGCI = () => {
                const price = parseFloat(gciCalculator.salePrice) || 0;
                const commissionRate = parseFloat(gciCalculator.commission) || 0;
                const splitRate = parseFloat(gciCalculator.splits) || 0;
                
                const grossCommission = price * (commissionRate / 100);
                const agentCommission = grossCommission * (splitRate / 100);
                
                return agentCommission;
            };

            const renderGoalsTab = () => (
                <div className="tab-content">
                    <h2>Daily & Weekly Goals</h2>
                    
                    <div className="form-grid">
                        <div className="card">
                            <h3>Daily Goals</h3>
                            <div className="form-group">
                                <label>Daily Leads Goal:</label>
                                <input
                                    type="number"
                                    value={goals.dailyLeads}
                                    onChange={(e) => setGoals({...goals, dailyLeads: parseInt(e.target.value) || 0})}
                                />
                            </div>
                            <div className="form-group">
                                <label>Daily Calls Goal:</label>
                                <input
                                    type="number"
                                    value={goals.dailyCalls}
                                    onChange={(e) => setGoals({...goals, dailyCalls: parseInt(e.target.value) || 0})}
                                />
                            </div>
                            <div className="form-group">
                                <label>Daily Appointments Goal:</label>
                                <input
                                    type="number"
                                    value={goals.dailyAppointments}
                                    onChange={(e) => setGoals({...goals, dailyAppointments: parseInt(e.target.value) || 0})}
                                />
                            </div>
                        </div>

                        <div className="card">
                            <h3>Weekly Goals</h3>
                            <div className="form-group">
                                <label>Weekly Leads Goal:</label>
                                <input
                                    type="number"
                                    value={goals.weeklyLeads}
                                    onChange={(e) => setGoals({...goals, weeklyLeads: parseInt(e.target.value) || 0})}
                                />
                            </div>
                            <div className="form-group">
                                <label>Weekly Calls Goal:</label>
                                <input
                                    type="number"
                                    value={goals.weeklyCalls}
                                    onChange={(e) => setGoals({...goals, weeklyCalls: parseInt(e.target.value) || 0})}
                                />
                            </div>
                            <div className="form-group">
                                <label>Weekly Appointments Goal:</label>
                                <input
                                    type="number"
                                    value={goals.weeklyAppointments}
                                    onChange={(e) => setGoals({...goals, weeklyAppointments: parseInt(e.target.value) || 0})}
                                />
                            </div>
                        </div>
                    </div>

                    <div className="reset-section">
                        <div className="reset-warning">⚠️ Danger Zone</div>
                        <p>Reset all goals, data, properties, transactions, and expenses.</p>
                        <button className="btn btn-danger" onClick={masterReset}>
                            Master Reset All Data
                        </button>
                    </div>
                </div>
            );

            const renderDashboardTab = () => (
                <div className="tab-content">
                    <h2>KPI Dashboard</h2>
                    
                    <div className="date-picker">
                        <label>Selected Date:</label>
                        <input
                            type="date"
                            value={selectedDate}
                            onChange={(e) => setSelectedDate(e.target.value)}
                        />
                    </div>

                    <div className="data-grid">
                        <div className="card">
                            <h3>Daily Input for {selectedDate}</h3>
                            <div className="form-group">
                                <label>Leads Generated:</label>
                                <input
                                    type="number"
                                    value={getDailyData(selectedDate, 'leads')}
                                    onChange={(e) => updateDailyData(selectedDate, 'leads', e.target.value)}
                                />
                            </div>
                            <div className="form-group">
                                <label>Calls Made:</label>
                                <input
                                    type="number"
                                    value={getDailyData(selectedDate, 'calls')}
                                    onChange={(e) => updateDailyData(selectedDate, 'calls', e.target.value)}
                                />
                            </div>
                            <div className="form-group">
                                <label>Appointments Set:</label>
                                <input
                                    type="number"
                                    value={getDailyData(selectedDate, 'appointments')}
                                    onChange={(e) => updateDailyData(selectedDate, 'appointments', e.target.value)}
                                />
                            </div>
                            <div className="form-group">
                                <label>Hours Worked:</label>
                                <input
                                    type="number"
                                    step="0.5"
                                    value={getDailyData(selectedDate, 'hoursWorked')}
                                    onChange={(e) => updateDailyData(selectedDate, 'hoursWorked', e.target.value)}
                                />
                            </div>
                        </div>

                        <div className="card">
                            <h3>Weekly Progress</h3>
                            <div className="progress-grid">
                                <ProgressWheel 
                                    percentage={getWeeklyProgress('leads', goals.weeklyLeads)} 
                                    label="Weekly Leads" 
                                />
                                <ProgressWheel 
                                    percentage={getWeeklyProgress('calls', goals.weeklyCalls)} 
                                    label="Weekly Calls" 
                                />
                                <ProgressWheel 
                                    percentage={getWeeklyProgress('appointments', goals.weeklyAppointments)} 
                                    label="Weekly Appointments" 
                                />
                            </div>
                        </div>
                    </div>

                    <div className="data-grid">
                        <div className="metric-card">
                            <div className="metric-value">{getWeeklyTotal('leads')}</div>
                            <div className="metric-label">Total Weekly Leads</div>
                        </div>
                        <div className="metric-card">
                            <div className="metric-value">{getWeeklyTotal('calls')}</div>
                            <div className="metric-label">Total Weekly Calls</div>
                        </div>
                        <div className="metric-card">
                            <div className="metric-value">{getWeeklyTotal('appointments')}</div>
                            <div className="metric-label">Total Weekly Appointments</div>
                        </div>
                        <div className="metric-card">
                            <div className="metric-value">${calculateEffectiveHourlyWage().toFixed(2)}</div>
                            <div className="metric-label">Effective Hourly Wage</div>
                        </div>
                    </div>
                </div>
            );

            const renderPerformanceTab = () => (
                <div className="tab-content">
                    <h2>Performance Analytics</h2>
                    
                    <div className="data-grid">
                        <div className="card">
                            <h3>Conversion Rates</h3>
                            <div className="metric-card">
                                <div className="metric-value">
                                    {getWeeklyTotal('calls') > 0 ? 
                                        ((getWeeklyTotal('appointments') / getWeeklyTotal('calls')) * 100).toFixed(1) : 0}%
                                </div>
                                <div className="metric-label">Call to Appointment Rate</div>
                            </div>
                        </div>

                        <div className="card">
                            <h3>Activity Summary</h3>
                            <div className="progress-grid">
                                <ProgressWheel 
                                    percentage={goals.dailyLeads > 0 ? Math.round((getDailyData(selectedDate, 'leads') / goals.dailyLeads) * 100) : 0}
                                    label="Daily Leads Progress"
                                />
                                <ProgressWheel 
                                    percentage={goals.dailyCalls > 0 ? Math.round((getDailyData(selectedDate, 'calls') / goals.dailyCalls) * 100) : 0}
                                    label="Daily Calls Progress"
                                />
                                <ProgressWheel 
                                    percentage={goals.dailyAppointments > 0 ? Math.round((getDailyData(selectedDate, 'appointments') / goals.dailyAppointments) * 100) : 0}
                                    label="Daily Appointments Progress"
                                />
                            </div>
                        </div>
                    </div>

                    <div className="card">
                        <h3>Efficiency Score</h3>
                        <div className="progress-grid">
                            <ProgressWheel 
                                percentage={Math.round(
                                    (getWeeklyProgress('leads', goals.weeklyLeads) + 
                                     getWeeklyProgress('calls', goals.weeklyCalls) + 
                                     getWeeklyProgress('appointments', goals.weeklyAppointments)) / 3
                                )}
                                label="Overall Weekly Efficiency"
                                color="#17a2b8"
                            />
                        </div>
                    </div>
                </div>
            );

            const renderTransactionsTab = () => {
                const [newProperty, setNewProperty] = useState({
                    address: '',
                    salePrice: '',
                    listingType: 'Listing',
                    expectedCloseDate: ''
                });

                const handleAddProperty = (e) => {
                    e.preventDefault();
                    if (newProperty.address.trim()) {
                        addProperty(newProperty);
                        setNewProperty({
                            address: '',
                            salePrice: '',
                            listingType: 'Listing',
                            expectedCloseDate: ''
                        });
                    }
                };

                return (
                    <div className="tab-content">
                        <h2>Transactions & Properties</h2>
                        
                        <div className="card">
                            <h3>Add New Property</h3>
                            <form onSubmit={handleAddProperty} className="form-grid">
                                <div className="form-group">
                                    <label>Property Address:</label>
                                    <input
                                        type="text"
                                        value={newProperty.address}
                                        onChange={(e) => setNewProperty({...newProperty, address: e.target.value})}
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Sale Price:</label>
                                    <input
                                        type="number"
                                        value={newProperty.salePrice}
                                        onChange={(e) => setNewProperty({...newProperty, salePrice: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Type:</label>
                                    <select
                                        value={newProperty.listingType}
                                        onChange={(e) => setNewProperty({...newProperty, listingType: e.target.value})}
                                    >
                                        <option value="Listing">Listing</option>
                                        <option value="Buyer">Buyer</option>
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label>Expected Close Date:</label>
                                    <input
                                        type="date"
                                        value={newProperty.expectedCloseDate}
                                        onChange={(e) => setNewProperty({...newProperty, expectedCloseDate: e.target.value})}
                                    />
                                </div>
                                <div>
                                    <button type="submit" className="btn">Add Property</button>
                                </div>
                            </form>
                        </div>

                        <div className="card">
                            <h3>Properties</h3>
                            {properties.length > 0 ? (
                                <table className="table">
                                    <thead>
                                        <tr>
                                            <th>Address</th>
                                            <th>Sale Price</th>
                                            <th>Type</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {properties.map(property => (
                                            <tr key={property.id}>
                                                <td>{property.address}</td>
                                                <td>${parseInt(property.salePrice || 0).toLocaleString()}</td>
                                                <td>{property.listingType}</td>
                                                <td>
                                                    <span className={`status-badge status-${property.status.toLowerCase()}`}>
                                                        {property.status}
                                                    </span>
                                                </td>
                                                <td>
                                                    <button 
                                                        className="btn btn-success"
                                                        onClick={() => updatePropertyStatus(property.id, 'Sold')}
                                                    >
                                                        Mark Sold
                                                    </button>
                                                    <button 
                                                        className="btn btn-danger"
                                                        onClick={() => deleteProperty(property.id)}
                                                    >
                                                        Delete
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            ) : (
                                <p>No properties added yet.</p>
                            )}
                        </div>

                        <div className="card">
                            <h3>Transactions</h3>
                            {transactions.length > 0 ? (
                                <table className="table">
                                    <thead>
                                        <tr>
                                            <th>Property</th>
                                            <th>Type</th>
                                            <th>Status</th>
                                            <th>Sale Price</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {transactions.map(transaction => {
                                            const property = properties.find(p => p.id === transaction.propertyId);
                                            return (
                                                <tr key={transaction.id}>
                                                    <td>{property?.address || 'Unknown'}</td>
                                                    <td>{transaction.type}</td>
                                                    <td>
                                                        <span className={`status-badge status-${transaction.status.toLowerCase()}`}>
                                                            {transaction.status}
                                                        </span>
                                                    </td>
                                                    <td>${parseInt(transaction.salePrice || 0).toLocaleString()}</td>
                                                    <td>
                                                        {transaction.status === 'Pending' && (
                                                            <button 
                                                                className="btn btn-success"
                                                                onClick={() => updateTransactionStatus(transaction.id, 'Closed')}
                                                            >
                                                                Mark Closed
                                                            </button>
                                                        )}
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            ) : (
                                <p>No transactions yet.</p>
                            )}
                        </div>
                    </div>
                );
            };

            const renderExpensesTab = () => {
                const [newExpense, setNewExpense] = useState({
                    description: '',
                    amount: '',
                    category: 'Marketing',
                    propertyId: ''
                });

                const handleAddExpense = (e) => {
                    e.preventDefault();
                    if (newExpense.description.trim() && newExpense.amount) {
                        addExpense(newExpense);
                        setNewExpense({
                            description: '',
                            amount: '',
                            category: 'Marketing',
                            propertyId: ''
                        });
                    }
                };

                const totalExpenses = expenses.reduce((sum, expense) => sum + (parseFloat(expense.amount) || 0), 0);

                return (
                    <div className="tab-content">
                        <h2>Expense Management</h2>
                        
                        <div className="data-grid">
                            <div className="card">
                                <h3>Add New Expense</h3>
                                <form onSubmit={handleAddExpense}>
                                    <div className="form-group">
                                        <label>Description:</label>
                                        <input
                                            type="text"
                                            value={newExpense.description}
                                            onChange={(e) => setNewExpense({...newExpense, description: e.target.value})}
                                            required
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>Amount:</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            value={newExpense.amount}
                                            onChange={(e) => setNewExpense({...newExpense, amount: e.target.value})}
                                            required
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>Category:</label>
                                        <select
                                            value={newExpense.category}
                                            onChange={(e) => setNewExpense({...newExpense, category: e.target.value})}
                                        >
                                            <option value="Marketing">Marketing</option>
                                            <option value="Transportation">Transportation</option>
                                            <option value="Office Supplies">Office Supplies</option>
                                            <option value="Professional Services">Professional Services</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>Related Property (Optional):</label>
                                        <select
                                            value={newExpense.propertyId}
                                            onChange={(e) => setNewExpense({...newExpense, propertyId: e.target.value})}
                                        >
                                            <option value="">None</option>
                                            {properties.map(property => (
                                                <option key={property.id} value={property.id}>
                                                    {property.address}
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                    <button type="submit" className="btn">Add Expense</button>
                                </form>
                            </div>

                            <div className="metric-card">
                                <div className="metric-value">${totalExpenses.toFixed(2)}</div>
                                <div className="metric-label">Total Expenses</div>
                            </div>
                        </div>

                        <div className="card">
                            <h3>Expense List</h3>
                            {expenses.length > 0 ? (
                                <table className="table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Description</th>
                                            <th>Category</th>
                                            <th>Amount</th>
                                            <th>Property</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {expenses.map(expense => {
                                            const property = properties.find(p => p.id == expense.propertyId);
                                            return (
                                                <tr key={expense.id}>
                                                    <td>{expense.date}</td>
                                                    <td>{expense.description}</td>
                                                    <td>{expense.category}</td>
                                                    <td>${parseFloat(expense.amount || 0).toFixed(2)}</td>
                                                    <td>{property?.address || 'N/A'}</td>
                                                    <td>
                                                        <button 
                                                            className="btn btn-danger"
                                                            onClick={() => deleteExpense(expense.id)}
                                                        >
                                                            Delete
                                                        </button>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            ) : (
                                <p>No expenses recorded yet.</p>
                            )}
                        </div>
                    </div>
                );
            };

            const renderGciCalculatorTab = () => {
                const gciAmount = calculateGCI();

                return (
                    <div className="tab-content">
                        <h2>GCI Calculator</h2>
                        
                        <div className="data-grid">
                            <div className="card">
                                <h3>Deal Calculator</h3>
                                <div className="form-group">
                                    <label>Sale Price:</label>
                                    <input
                                        type="number"
                                        value={gciCalculator.salePrice}
                                        onChange={(e) => setGciCalculator({...gciCalculator, salePrice: e.target.value})}
                                        placeholder="Enter sale price"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Commission Rate (%):</label>
                                    <input
                                        type="number"
                                        step="0.1"
                                        value={gciCalculator.commission}
                                        onChange={(e) => setGciCalculator({...gciCalculator, commission: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Your Split (%):</label>
                                    <input
                                        type="number"
                                        step="0.1"
                                        value={gciCalculator.splits}
                                        onChange={(e) => setGciCalculator({...gciCalculator, splits: e.target.value})}
                                    />
                                </div>
                                
                                {gciAmount > 0 && (
                                    <div className="calculator-result">
                                        Your Commission: ${gciAmount.toFixed(2)}
                                    </div>
                                )}
                            </div>

                            <div className="card">
                                <h3>Quick Calculations</h3>
                                <div className="metric-card">
                                    <div className="metric-value">
                                        ${(parseFloat(gciCalculator.salePrice) || 0).toLocaleString()}
                                    </div>
                                    <div className="metric-label">Sale Price</div>
                                </div>
                                <div className="metric-card">
                                    <div className="metric-value">
                                        ${((parseFloat(gciCalculator.salePrice) || 0) * (parseFloat(gciCalculator.commission) || 0) / 100).toFixed(2)}
                                    </div>
                                    <div className="metric-label">Gross Commission</div>
                                </div>
                                <div className="metric-card">
                                    <div className="metric-value">
                                        ${gciAmount.toFixed(2)}
                                    </div>
                                    <div className="metric-label">Your Commission</div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const renderReportsTab = () => {
                const closedTransactions = transactions.filter(t => t.status === 'Closed');
                const totalGCI = closedTransactions.reduce((sum, t) => {
                    const salePrice = parseFloat(t.salePrice) || 0;
                    const commission = salePrice * 0.03; // Assuming 3% commission
                    return sum + (commission * 0.5); // Assuming 50% split
                }, 0);

                const totalExpenses = expenses.reduce((sum, expense) => sum + (parseFloat(expense.amount) || 0), 0);
                const netIncome = totalGCI - totalExpenses;

                return (
                    <div className="tab-content">
                        <h2>Reports & Analytics</h2>
                        
                        <div className="data-grid">
                            <div className="metric-card">
                                <div className="metric-value">${totalGCI.toFixed(2)}</div>
                                <div className="metric-label">Total GCI</div>
                            </div>
                            <div className="metric-card">
                                <div className="metric-value">${totalExpenses.toFixed(2)}</div>
                                <div className="metric-label">Total Expenses</div>
                            </div>
                            <div className="metric-card">
                                <div className="metric-value">${netIncome.toFixed(2)}</div>
                                <div className="metric-label">Net Income</div>
                            </div>
                            <div className="metric-card">
                                <div className="metric-value">{closedTransactions.length}</div>
                                <div className="metric-label">Closed Deals</div>
                            </div>
                        </div>

                        <div className="data-grid">
                            <div className="card">
                                <h3>Performance Summary</h3>
                                <div className="progress-grid">
                                    <ProgressWheel 
                                        percentage={Math.min((closedTransactions.length / 12) * 100, 100)}
                                        label="Annual Goal (12 deals)"
                                        color="#28a745"
                                    />
                                    <ProgressWheel 
                                        percentage={netIncome > 0 ? Math.min((netIncome / 100000) * 100, 100) : 0}
                                        label="Income Goal ($100K)"
                                        color="#007bff"
                                    />
                                </div>
                            </div>

                            <div className="card">
                                <h3>Recent Activity</h3>
                                <p>Properties: {properties.length} active</p>
                                <p>Pending Transactions: {transactions.filter(t => t.status === 'Pending').length}</p>
                                <p>Closed Transactions: {closedTransactions.length}</p>
                                <p>This Week's Leads: {getWeeklyTotal('leads')}</p>
                                <p>This Week's Calls: {getWeeklyTotal('calls')}</p>
                                <p>This Week's Appointments: {getWeeklyTotal('appointments')}</p>
                            </div>
                        </div>
                    </div>
                );
            };

            const tabs = [
                { id: 'goals', label: 'Goals', component: renderGoalsTab },
                { id: 'dashboard', label: 'Dashboard', component: renderDashboardTab },
                { id: 'performance', label: 'Performance', component: renderPerformanceTab },
                { id: 'transactions', label: 'Transactions', component: renderTransactionsTab },
                { id: 'expenses', label: 'Expenses', component: renderExpensesTab },
                { id: 'gci-calculator', label: 'GCI Calculator', component: renderGciCalculatorTab },
                { id: 'reports', label: 'Reports', component: renderReportsTab }
            ];

            return (
                <div className="container">
                    <div className="header">
                        <h1>KPI Dashboard</h1>
                        <button 
                            className="theme-toggle"
                            onClick={() => setIsDarkMode(!isDarkMode)}
                        >
                            {isDarkMode ? '☀️ Light Mode' : '🌙 Dark Mode'}
                        </button>
                    </div>
                    
                    <div className="tabs">
                        {tabs.map(tab => (
                            <button
                                key={tab.id}
                                className={`tab ${activeTab === tab.id ? 'active' : ''}`}
                                onClick={() => setActiveTab(tab.id)}
                            >
                                {tab.label}
                            </button>
                        ))}
                    </div>
                    
                    {tabs.find(tab => tab.id === activeTab)?.component()}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
