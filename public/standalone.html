<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real Estate KPI Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 800px;
    }
    .tabs {
      display: flex;
      border-bottom: 2px solid #ddd;
      margin-bottom: 20px;
      flex-wrap: wrap;
      min-height: 50px;
    }
    .tab {
      padding: 10px 15px;
      cursor: pointer;
      background: #f8f9fa;
      border: 1px solid #ddd;
      margin-right: 5px;
      margin-bottom: 5px;
      border-radius: 5px 5px 0 0;
      font-size: 14px;
      min-width: 80px;
      text-align: center;
      white-space: nowrap;
    }
    .tab.active {
      background: #007bff;
      color: white;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    .tile {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      border: 1px solid #ddd;
    }
    .tile h3, .tile h4 {
      margin: 0 0 10px 0;
      color: #333;
    }
    .tile p {
      font-size: 24px;
      font-weight: bold;
      margin: 10px 0;
      color: #007bff;
    }
    .tile small {
      color: #666;
      font-size: 12px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }
    .btn {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    .btn:hover {
      background: #0056b3;
    }
    .btn.btn-success {
      background: #28a745;
    }
    .btn.btn-danger {
      background: #dc3545;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #f8f9fa;
      font-weight: bold;
    }
    .section {
      margin-bottom: 30px;
    }
    .section h2 {
      color: #C5A95E;
      border-bottom: 2px solid #C5A95E;
      padding-bottom: 10px;
    }
    .section h3 {
      color: #333;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
    }
    .form-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    .progress-wheel {
      width: 100px;
      height: 100px;
      margin: 0 auto 10px;
    }
    .progress-wheel circle {
      fill: none;
      stroke-width: 8;
    }
    .progress-wheel .bg {
      stroke: #e0e0e0;
    }
    .progress-wheel .progress {
      stroke: #C5A95E;
      stroke-linecap: round;
      transform: rotate(-90deg);
      transform-origin: 50% 50%;
    }
    .progress-text {
      font-size: 14px;
      font-weight: bold;
      fill: #333;
    }
    .goal-input {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    .daily-input {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .daily-input h4 {
      margin-bottom: 15px;
      color: #333;
    }
    .conversion-tile {
      background: #e8f5e8;
      border: 1px solid #28a745;
    }
    .conversion-tile p {
      color: #28a745;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .insights-card {
      background: #f9f9f9;
      border: 1px solid #28a745;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .insights-card h4 {
      color: #28a745;
      margin-bottom: 10px;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
      margin-bottom: 20px;
    }
    .calendar-day {
      padding: 10px;
      text-align: center;
      border: 1px solid #ddd;
      background: #f8f9fa;
      cursor: pointer;
      min-height: 40px;
    }
    .calendar-day:hover {
      background: #e9ecef;
    }
    .calendar-day.today {
      background: #C5A95E;
      color: white;
    }
    .calendar-day.has-data {
      background: #d4edda;
      color: #155724;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 style="text-align: center; color: #C5A95E; margin-bottom: 30px;">Real Estate KPI Dashboard</h1>
    
    <div class="tabs">
      <div class="tab active" onclick="showTab('properties')">Properties</div>
      <div class="tab" onclick="showTab('dashboard')">Dashboard</div>
      <div class="tab" onclick="showTab('goals')">Goals</div>
      <div class="tab" onclick="showTab('performance')">Performance</div>
      <div class="tab" onclick="showTab('calendar')">Calendar</div>
      <div class="tab" onclick="showTab('settings')">Settings</div>
    </div>
    
    <!-- Properties Tab -->
    <div id="properties" class="tab-content active">
      <h2>Properties Management</h2>
      
      <div class="form-section">
        <h3>Add New Property</h3>
        <form id="propertyForm">
          <div class="form-group">
            <label>Address:</label>
            <input type="text" id="address" placeholder="123 Main Street" required>
          </div>
          <div class="form-group">
            <label>Client:</label>
            <input type="text" id="client" placeholder="John Doe">
          </div>
          <div class="form-group">
            <label>Type:</label>
            <select id="type">
              <option value="Seller">Seller</option>
              <option value="Buyer">Buyer</option>
            </select>
          </div>
          <div class="form-group">
            <label>Price ($):</label>
            <input type="number" id="price" placeholder="450000" min="0" step="0.01">
          </div>
          <div class="form-group">
            <label>Commission %:</label>
            <input type="number" id="commission" placeholder="2.5" min="0" max="100" step="0.1" value="2.5">
          </div>
          <div class="form-group">
            <label>Date:</label>
            <input type="date" id="date">
          </div>
          <div class="form-group">
            <label>Lead Source:</label>
            <select id="leadSource">
              <option value="Social Media">Social Media</option>
              <option value="SOI">SOI</option>
              <option value="Zillow">Zillow</option>
              <option value="OpCity">OpCity</option>
              <option value="Referral">Referral</option>
              <option value="UpNest">UpNest</option>
              <option value="Homelight">Homelight</option>
              <option value="OneSuite">OneSuite</option>
              <option value="Direct Mail">Direct Mail</option>
              <option value="Realtor">Realtor</option>
            </select>
          </div>
          <div class="form-group">
            <label>Notes:</label>
            <textarea id="notes" placeholder="Additional notes..." rows="3"></textarea>
          </div>
          <button type="submit" class="btn">Add Property</button>
        </form>
      </div>
      
      <div id="transactionTables"></div>
    </div>
    
    <!-- Dashboard Tab -->
    <div id="dashboard" class="tab-content">
      <h2>Performance Dashboard</h2>
      
      <div class="section">
        <h3>Today's Performance</h3>
        <div class="daily-input">
          <h4>Daily Data Input - <span id="selectedDateDisplay"></span></h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div class="form-group">
              <label>Date:</label>
              <input type="date" id="dailyDate" onchange="updateSelectedDate(this.value)">
            </div>
            <div class="form-group">
              <label>Hours Worked:</label>
              <input type="number" id="hoursWorked" placeholder="8" min="0" step="0.5" onchange="updateDailyData()">
            </div>
            <div class="form-group">
              <label>Calls Made:</label>
              <input type="number" id="callsMade" placeholder="50" min="0" onchange="updateDailyData()">
            </div>
            <div class="form-group">
              <label>Calls Answered:</label>
              <input type="number" id="callsAnswered" placeholder="25" min="0" onchange="updateDailyData()">
            </div>
            <div class="form-group">
              <label>Listing Appointments:</label>
              <input type="number" id="listingAppts" placeholder="3" min="0" onchange="updateDailyData()">
            </div>
            <div class="form-group">
              <label>Buyer Appointments:</label>
              <input type="number" id="buyerAppts" placeholder="2" min="0" onchange="updateDailyData()">
            </div>
            <div class="form-group">
              <label>Offers Written:</label>
              <input type="number" id="offersWritten" placeholder="5" min="0" onchange="updateDailyData()">
            </div>
            <div class="form-group">
              <label>Listing Agreements:</label>
              <input type="number" id="listingAgreements" placeholder="2" min="0" onchange="updateDailyData()">
            </div>
            <div class="form-group">
              <label>Buyer Contracts:</label>
              <input type="number" id="buyerContracts" placeholder="3" min="0" onchange="updateDailyData()">
            </div>
            <div class="form-group">
              <label>Showings:</label>
              <input type="number" id="showings" placeholder="10" min="0" onchange="updateDailyData()">
            </div>
            <div class="form-group">
              <label>Leads Generated:</label>
              <input type="number" id="leadsGenerated" placeholder="15" min="0" onchange="updateDailyData()">
            </div>
          </div>
        </div>
      </div>
      
      <div class="section">
        <h3>Key Performance Indicators</h3>
        <div class="grid">
          <div class="tile">
            <h4>Total Commission</h4>
            <p id="totalCommission">$0</p>
            <small>From closed deals</small>
          </div>
          <div class="tile">
            <h4>Active Properties</h4>
            <p id="activeProperties">0</p>
            <small>Under contract & pending</small>
          </div>
          <div class="tile">
            <h4>Closed Deals</h4>
            <p id="closedDeals">0</p>
            <small>This year</small>
          </div>
          <div class="tile">
            <h4>Hourly Rate</h4>
            <p id="hourlyRate">$0</p>
            <small>Commission per hour</small>
          </div>
          <div class="tile">
            <h4>Volume Under Contract</h4>
            <p id="volumeUnderContract">$0</p>
            <small>Pending commission</small>
          </div>
          <div class="tile">
            <h4>Total Work Hours</h4>
            <p id="totalHours">0</p>
            <small>This year</small>
          </div>
        </div>
      </div>
      
      <div class="section">
        <h3>Conversion Rates</h3>
        <div class="grid">
          <div class="tile conversion-tile">
            <h4>Listing Agreement ‚Üí Closing</h4>
            <p id="listingConversion">0%</p>
            <small id="listingConversionDetail">0 closed / 0 agreements</small>
          </div>
          <div class="tile conversion-tile">
            <h4>Buyer Contract ‚Üí Closing</h4>
            <p id="buyerConversion">0%</p>
            <small id="buyerConversionDetail">0 closed / 0 contracts</small>
          </div>
          <div class="tile conversion-tile">
            <h4>Listing Appt ‚Üí Agreement</h4>
            <p id="listingApptConversion">0%</p>
            <small id="listingApptConversionDetail">0 agreements / 0 appointments</small>
          </div>
          <div class="tile conversion-tile">
            <h4>Buyer Appt ‚Üí Contract</h4>
            <p id="buyerApptConversion">0%</p>
            <small id="buyerApptConversionDetail">0 contracts / 0 appointments</small>
          </div>
          <div class="tile conversion-tile">
            <h4>Call Answer Rate</h4>
            <p id="callAnswerRate">0%</p>
            <small id="callAnswerRateDetail">0 answered / 0 made</small>
          </div>
        </div>
      </div>
      
      <div class="section">
        <h3>Reports</h3>
        <div>
          <button class="btn" onclick="generateDailyReport()">üìß Daily Report</button>
          <button class="btn" onclick="generateWeeklyReport()">üìß Weekly Report</button>
          <button class="btn" onclick="generateMonthlyReport()">üìß Monthly Report</button>
          <button class="btn btn-success" onclick="testEmailConnection()">üìß Test Email</button>
        </div>
      </div>
    </div>
    
    <!-- Goals Tab -->
    <div id="goals" class="tab-content">
      <h2>Goals & Progress Tracking</h2>
      
      <div class="section">
        <h3>Set Goals</h3>
        <div class="goal-input">
          <div>
            <h4>Daily Goals</h4>
            <div class="form-group">
              <label>Daily Calls:</label>
              <input type="number" id="dailyCalls" value="10" onchange="updateGoals()">
            </div>
            <div class="form-group">
              <label>Daily Hours:</label>
              <input type="number" id="dailyHours" value="8" onchange="updateGoals()">
            </div>
            <div class="form-group">
              <label>Daily Appointments:</label>
              <input type="number" id="dailyAppointments" value="2" onchange="updateGoals()">
            </div>
            <div class="form-group">
              <label>Daily Offers:</label>
              <input type="number" id="dailyOffers" value="5" onchange="updateGoals()">
            </div>
            <div class="form-group">
              <label>Daily Listing Agreements:</label>
              <input type="number" id="dailyListingAgreements" value="2" onchange="updateGoals()">
            </div>
            <div class="form-group">
              <label>Daily Buyer Contracts:</label>
              <input type="number" id="dailyBuyerContracts" value="3" onchange="updateGoals()">
            </div>
          </div>
          <div>
            <h4>Weekly Goals</h4>
            <div class="form-group">
              <label>Weekly Calls:</label>
              <input type="number" id="weeklyCalls" value="70" onchange="updateGoals()">
            </div>
            <div class="form-group">
              <label>Weekly Hours:</label>
              <input type="number" id="weeklyHours" value="40" onchange="updateGoals()">
            </div>
            <div class="form-group">
              <label>Weekly Appointments:</label>
              <input type="number" id="weeklyAppointments" value="10" onchange="updateGoals()">
            </div>
            <div class="form-group">
              <label>Weekly Offers:</label>
              <input type="number" id="weeklyOffers" value="25" onchange="updateGoals()">
            </div>
            <div class="form-group">
              <label>Weekly Listing Agreements:</label>
              <input type="number" id="weeklyListingAgreements" value="10" onchange="updateGoals()">
            </div>
            <div class="form-group">
              <label>Weekly Buyer Contracts:</label>
              <input type="number" id="weeklyBuyerContracts" value="15" onchange="updateGoals()">
            </div>
          </div>
          <div>
            <h4>Monthly Goals</h4>
            <div class="form-group">
              <label>Monthly Calls:</label>
              <input type="number" id="monthlyCalls" value="300" onchange="updateGoals()">
            </div>
            <div class="form-group">
              <label>Monthly Hours:</label>
              <input type="number" id="monthlyHours" value="160" onchange="updateGoals()">
            </div>
            <div class="form-group">
              <label>Monthly Appointments:</label>
              <input type="number" id="monthlyAppointments" value="40" onchange="updateGoals()">
            </div>
            <div class="form-group">
              <label>Monthly Offers:</label>
              <input type="number" id="monthlyOffers" value="100" onchange="updateGoals()">
            </div>
            <div class="form-group">
              <label>Monthly Listing Agreements:</label>
              <input type="number" id="monthlyListingAgreements" value="40" onchange="updateGoals()">
            </div>
            <div class="form-group">
              <label>Monthly Buyer Contracts:</label>
              <input type="number" id="monthlyBuyerContracts" value="60" onchange="updateGoals()">
            </div>
          </div>
        </div>
      </div>
      
      <div class="section">
        <h3>Today's Progress</h3>
        <div class="grid" id="dailyProgress"></div>
      </div>
      
      <div class="section">
        <h3>Weekly Progress</h3>
        <div class="grid" id="weeklyProgress"></div>
      </div>
      
      <div class="section">
        <h3>Monthly Progress</h3>
        <div class="grid" id="monthlyProgress"></div>
      </div>
    </div>
    
    <!-- Performance Tab -->
    <div id="performance" class="tab-content">
      <h2>Performance Analysis</h2>
      
      <div class="section">
        <h3>Business Intelligence</h3>
        <div class="insights-card">
          <h4>üéØ Activity Insights</h4>
          <div id="activityInsights"></div>
        </div>
        
        <div class="insights-card">
          <h4>üìä Conversion Insights</h4>
          <div id="conversionInsights"></div>
        </div>
        
        <div class="insights-card">
          <h4>üíº Pipeline Health</h4>
          <div id="pipelineInsights"></div>
        </div>
      </div>
      
      <div class="section">
        <h3>Lead Source Performance</h3>
        <div class="grid" id="leadSourceGrid"></div>
      </div>
      
      <div class="section">
        <h3>Monthly Breakdown</h3>
        <div id="monthlyBreakdown"></div>
      </div>
    </div>
    
    <!-- Calendar Tab -->
    <div id="calendar" class="tab-content">
      <h2>Calendar & Events</h2>
      
      <div class="section">
        <h3>Calendar Navigation</h3>
        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
          <button class="btn" onclick="changeMonth(-1)">‚Üê Previous</button>
          <h3 id="calendarMonth" style="margin: 0;"></h3>
          <button class="btn" onclick="changeMonth(1)">Next ‚Üí</button>
        </div>
      </div>
      
      <div class="section">
        <div id="calendarGrid"></div>
      </div>
      
      <div class="section">
        <h3>Daily Performance Summary</h3>
        <div id="dailyPerformanceCalendar"></div>
      </div>
    </div>
    
    <!-- Settings Tab -->
    <div id="settings" class="tab-content">
      <h2>Settings</h2>
      
      <div class="section">
        <h3>Application Settings</h3>
        <div class="form-group">
          <label>App Name:</label>
          <input type="text" id="appName" value="Real Estate KPI Dashboard" onchange="updateAppName()">
        </div>
        <div class="form-group">
          <label>Hourly Rate ($):</label>
          <input type="number" id="hourlyRate" value="50" min="0" step="0.01" onchange="updateHourlyRate()">
        </div>
        <div class="form-group">
          <label>Report Email:</label>
          <input type="email" id="reportEmail" value="nhcazateam@gmail.com" onchange="updateReportEmail()">
        </div>
      </div>
      
      <div class="section">
        <h3>Email Configuration</h3>
        <div class="form-group">
          <label>Email Service:</label>
          <select id="emailService">
            <option value="gmail">Gmail</option>
            <option value="outlook">Outlook</option>
            <option value="yahoo">Yahoo</option>
            <option value="custom">Custom SMTP</option>
          </select>
        </div>
        <div class="form-group">
          <label>Email Address:</label>
          <input type="email" id="emailAddress" placeholder="your-email@gmail.com">
        </div>
        <div class="form-group">
          <label>App Password:</label>
          <input type="password" id="emailPassword" placeholder="Your app password">
        </div>
        <button class="btn" onclick="testEmailConnection()">Test Email Connection</button>
      </div>
      
      <div class="section">
        <h3>GCI Settings</h3>
        <div class="form-group">
          <label>GCI Goal ($):</label>
          <input type="number" id="gciGoal" value="215000" min="0" onchange="updateGCISettings()">
        </div>
        <div class="form-group">
          <label>Average Sale Price ($):</label>
          <input type="number" id="avgSale" value="325090" min="0" onchange="updateGCISettings()">
        </div>
        <div class="form-group">
          <label>Average Commission (%):</label>
          <input type="number" id="avgCommission" value="2.5" min="0" max="100" step="0.1" onchange="updateGCISettings()">
        </div>
      </div>
      
      <div class="section">
        <h3>Data Management</h3>
        <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button>
        <button class="btn" onclick="exportData()">Export Data</button>
        <button class="btn" onclick="importData()">Import Data</button>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let properties = JSON.parse(localStorage.getItem('properties') || '[]');
    let contractTransactions = JSON.parse(localStorage.getItem('contractTransactions') || '[]');
    let closedDeals = JSON.parse(localStorage.getItem('closedDeals') || '[]');
    let dailyInputs = JSON.parse(localStorage.getItem('dailyInputs') || '{}');
    let goals = JSON.parse(localStorage.getItem('goals') || '{"daily":{"calls":10,"hours":8,"appointments":2,"offersWritten":5,"listingAgreements":2,"buyerContracts":3},"weekly":{"calls":70,"hours":40,"appointments":10,"offersWritten":25,"listingAgreements":10,"buyerContracts":15},"monthly":{"calls":300,"hours":160,"appointments":40,"offersWritten":100,"listingAgreements":40,"buyerContracts":60}}');
    let appSettings = JSON.parse(localStorage.getItem('appSettings') || '{"hourlyRate":50,"reportEmail":"nhcazateam@gmail.com","gciGoal":215000,"avgSale":325090,"avgCommission":2.5}');
    let currentCalendarDate = new Date();
    let selectedDate = new Date().toISOString().split('T')[0];
    
    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('date').value = selectedDate;
      document.getElementById('dailyDate').value = selectedDate;
      updateSelectedDate(selectedDate);
      loadAppSettings();
      updateTransactionTables();
      updateDashboard();
      updateGoalsDisplay();
      updateCalendar();
    });
    
    // Tab switching
    function showTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');
      
      if (tabName === 'calendar') {
        updateCalendar();
      } else if (tabName === 'performance') {
        updatePerformanceTab();
      } else if (tabName === 'goals') {
        updateGoalsDisplay();
      }
    }
    
    // Property form submission
    document.getElementById('propertyForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const address = document.getElementById('address').value;
      const client = document.getElementById('client').value;
      const type = document.getElementById('type').value;
      const price = parseFloat(document.getElementById('price').value) || 0;
      const commissionPercent = parseFloat(document.getElementById('commission').value) || 2.5;
      const date = document.getElementById('date').value;
      const leadSource = document.getElementById('leadSource').value;
      const notes = document.getElementById('notes').value;
      
      if (address) {
        const newProperty = {
          id: Date.now() + Math.random(),
          address,
          client,
          type,
          price,
          commissionPercent,
          commission: (price * commissionPercent / 100),
          date,
          leadSource,
          notes,
          timestamp: new Date().toISOString()
        };
        
        properties.push(newProperty);
        
        // Add to contract transactions
        const newTransaction = {
          ...newProperty,
          status: 'Under Contract',
          addedDate: new Date().toISOString().split('T')[0]
        };
        contractTransactions.push(newTransaction);
        
        // Save to localStorage
        localStorage.setItem('properties', JSON.stringify(properties));
        localStorage.setItem('contractTransactions', JSON.stringify(contractTransactions));
        
        // Reset form
        document.getElementById('propertyForm').reset();
        document.getElementById('date').value = selectedDate;
        document.getElementById('commission').value = '2.5';
        
        // Update displays
        updateTransactionTables();
        updateDashboard();
      }
    });
    
    // Daily data input functions
    function updateSelectedDate(date) {
      selectedDate = date;
      document.getElementById('selectedDateDisplay').textContent = new Date(date).toLocaleDateString();
      loadDailyData();
    }
    
    function loadDailyData() {
      const dayData = dailyInputs[selectedDate] || {};
      document.getElementById('hoursWorked').value = dayData.hoursWorked || '';
      document.getElementById('callsMade').value = dayData.callsMade || '';
      document.getElementById('callsAnswered').value = dayData.callsAnswered || '';
      document.getElementById('listingAppts').value = dayData.listingAppts || '';
      document.getElementById('buyerAppts').value = dayData.buyerAppts || '';
      document.getElementById('offersWritten').value = dayData.offersWritten || '';
      document.getElementById('listingAgreements').value = dayData.listingAgreements || '';
      document.getElementById('buyerContracts').value = dayData.buyerContracts || '';
      document.getElementById('showings').value = dayData.showings || '';
      document.getElementById('leadsGenerated').value = dayData.leadsGenerated || '';
    }
    
    function updateDailyData() {
      const dayData = {
        date: selectedDate,
        hoursWorked: parseFloat(document.getElementById('hoursWorked').value) || 0,
        callsMade: parseInt(document.getElementById('callsMade').value) || 0,
        callsAnswered: parseInt(document.getElementById('callsAnswered').value) || 0,
        listingAppts: parseInt(document.getElementById('listingAppts').value) || 0,
        buyerAppts: parseInt(document.getElementById('buyerAppts').value) || 0,
        offersWritten: parseInt(document.getElementById('offersWritten').value) || 0,
        listingAgreements: parseInt(document.getElementById('listingAgreements').value) || 0,
        buyerContracts: parseInt(document.getElementById('buyerContracts').value) || 0,
        showings: parseInt(document.getElementById('showings').value) || 0,
        leadsGenerated: parseInt(document.getElementById('leadsGenerated').value) || 0
      };
      
      dailyInputs[selectedDate] = dayData;
      localStorage.setItem('dailyInputs', JSON.stringify(dailyInputs));
      
      updateDashboard();
      updateGoalsDisplay();
    }
    
    // Transaction management
    function updateTransactionStatus(transactionId, newStatus) {
      const transactionIndex = contractTransactions.findIndex(t => t.id === transactionId);
      if (transactionIndex !== -1) {
        const transaction = contractTransactions[transactionIndex];
        
        if (newStatus === 'Closed') {
          const closedDeal = {
            ...transaction,
            status: newStatus,
            closedDate: new Date().toISOString().split('T')[0]
          };
          closedDeals.push(closedDeal);
          contractTransactions.splice(transactionIndex, 1);
        } else {
          contractTransactions[transactionIndex].status = newStatus;
        }
        
        localStorage.setItem('contractTransactions', JSON.stringify(contractTransactions));
        localStorage.setItem('closedDeals', JSON.stringify(closedDeals));
        updateTransactionTables();
        updateDashboard();
      }
    }
    
    function deleteTransaction(transactionId, isClosed = false) {
      const confirmMessage = 'Are you sure you want to delete this transaction?';
      if (confirm(confirmMessage)) {
        if (isClosed) {
          closedDeals = closedDeals.filter(t => t.id !== transactionId);
          localStorage.setItem('closedDeals', JSON.stringify(closedDeals));
        } else {
          contractTransactions = contractTransactions.filter(t => t.id !== transactionId);
          localStorage.setItem('contractTransactions', JSON.stringify(contractTransactions));
        }
        updateTransactionTables();
        updateDashboard();
      }
    }
    
    // Update transaction tables
    function updateTransactionTables() {
      const container = document.getElementById('transactionTables');
      container.innerHTML = '';
      
      const statuses = ['Under Contract', 'Pending', 'Withdrawn', 'Expired', 'Terminated', 'Fired Client'];
      
      statuses.forEach(status => {
        const transactions = contractTransactions.filter(t => t.status === status);
        if (transactions.length > 0) {
          const section = createTransactionSection(status, transactions);
          container.appendChild(section);
        }
      });
      
      if (closedDeals.length > 0) {
        const closedSection = createClosedDealsSection();
        container.appendChild(closedSection);
      }
    }
    
    function createTransactionSection(status, transactions) {
      const section = document.createElement('div');
      section.className = 'section';
      
      const showCommission = !['Withdrawn', 'Expired', 'Terminated', 'Fired Client'].includes(status);
      
      section.innerHTML = `
        <h3>${status}</h3>
        <table>
          <thead>
            <tr>
              <th>Address</th>
              <th>Client</th>
              <th>Type</th>
              ${showCommission ? '<th>Price ($)</th>' : ''}
              ${showCommission ? '<th>Commission ($)</th>' : ''}
              <th>Date</th>
              <th>Lead Source</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${transactions.map(transaction => `
              <tr>
                <td>${transaction.address}</td>
                <td>${transaction.client || '-'}</td>
                <td>${transaction.type}</td>
                ${showCommission ? `<td>$${transaction.price.toLocaleString()}</td>` : ''}
                ${showCommission ? `<td>$${transaction.commission.toFixed(2)}</td>` : ''}
                <td>${new Date(transaction.date).toLocaleDateString()}</td>
                <td>${transaction.leadSource || '-'}</td>
                <td>
                  ${(status === 'Under Contract' || status === 'Pending') ? `
                    <select onchange="updateTransactionStatus(${transaction.id}, this.value)" style="margin-right: 10px;">
                      <option value="Under Contract" ${status === 'Under Contract' ? 'selected' : ''}>Under Contract</option>
                      <option value="Pending" ${status === 'Pending' ? 'selected' : ''}>Pending</option>
                      <option value="Closed">Closed</option>
                      <option value="Withdrawn">Withdrawn</option>
                      <option value="Expired">Expired</option>
                      <option value="Terminated">Terminated</option>
                      <option value="Fired Client">Fired Client</option>
                    </select>
                  ` : ''}
                  <button onclick="deleteTransaction(${transaction.id})" class="btn btn-danger">Delete</button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      
      return section;
    }
    
    function createClosedDealsSection() {
      const section = document.createElement('div');
      section.className = 'section';
      
      section.innerHTML = `
        <h3>Closed Deals</h3>
        <table>
          <thead>
            <tr>
              <th>Address</th>
              <th>Client</th>
              <th>Type</th>
              <th>Price ($)</th>
              <th>Commission ($)</th>
              <th>Closed Date</th>
              <th>Lead Source</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${closedDeals.map(deal => `
              <tr>
                <td>${deal.address}</td>
                <td>${deal.client || '-'}</td>
                <td>${deal.type}</td>
                <td>$${deal.price.toLocaleString()}</td>
                <td>$${deal.commission.toFixed(2)}</td>
                <td>${new Date(deal.closedDate).toLocaleDateString()}</td>
                <td>${deal.leadSource || '-'}</td>
                <td>
                  <button onclick="deleteTransaction(${deal.id}, true)" class="btn btn-danger">Delete</button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      
      return section;
    }
    
    // Dashboard updates
    function updateDashboard() {
      const totalCommission = closedDeals.reduce((sum, deal) => sum + (deal.commission || 0), 0);
      const activeProperties = contractTransactions.filter(t => ['Under Contract', 'Pending'].includes(t.status)).length;
      const totalHours = Object.values(dailyInputs).reduce((sum, day) => sum + (day.hoursWorked || 0), 0);
      const hourlyRate = totalHours > 0 ? totalCommission / totalHours : 0;
      const volumeUnderContract = contractTransactions.filter(t => t.status === 'Under Contract').reduce((sum, t) => sum + (t.price || 0), 0);
      
      document.getElementById('totalCommission').textContent = '$' + totalCommission.toLocaleString();
      document.getElementById('activeProperties').textContent = activeProperties;
      document.getElementById('closedDeals').textContent = closedDeals.length;
      document.getElementById('hourlyRate').textContent = '$' + hourlyRate.toFixed(0);
      document.getElementById('volumeUnderContract').textContent = '$' + volumeUnderContract.toLocaleString();
      document.getElementById('totalHours').textContent = totalHours.toFixed(1);
      
      updateConversionRates();
    }
    
    function updateConversionRates() {
      const totalBuyerDeals = closedDeals.filter(deal => deal.type === 'Buyer').length;
      const totalSellerDeals = closedDeals.filter(deal => deal.type === 'Seller').length;
      const totalBuyerContracts = Object.values(dailyInputs).reduce((sum, day) => sum + (day.buyerContracts || 0), 0);
      const totalListingAgreements = Object.values(dailyInputs).reduce((sum, day) => sum + (day.listingAgreements || 0), 0);
      const totalBuyerAppts = Object.values(dailyInputs).reduce((sum, day) => sum + (day.buyerAppts || 0), 0);
      const totalListingAppts = Object.values(dailyInputs).reduce((sum, day) => sum + (day.listingAppts || 0), 0);
      const totalCallsMade = Object.values(dailyInputs).reduce((sum, day) => sum + (day.callsMade || 0), 0);
      const totalCallsAnswered = Object.values(dailyInputs).reduce((sum, day) => sum + (day.callsAnswered || 0), 0);
      
      const buyerConversionRate = totalBuyerContracts > 0 ? (totalBuyerDeals / totalBuyerContracts) * 100 : 0;
      const listingConversionRate = totalListingAgreements > 0 ? (totalSellerDeals / totalListingAgreements) * 100 : 0;
      const buyerApptConversionRate = totalBuyerAppts > 0 ? (totalBuyerContracts / totalBuyerAppts) * 100 : 0;
      const listingApptConversionRate = totalListingAppts > 0 ? (totalListingAgreements / totalListingAppts) * 100 : 0;
      const callAnswerRate = totalCallsMade > 0 ? (totalCallsAnswered / totalCallsMade) * 100 : 0;
      
      document.getElementById('buyerConversion').textContent = buyerConversionRate.toFixed(1) + '%';
      document.getElementById('buyerConversionDetail').textContent = `${totalBuyerDeals} closed / ${totalBuyerContracts} contracts`;
      document.getElementById('listingConversion').textContent = listingConversionRate.toFixed(1) + '%';
      document.getElementById('listingConversionDetail').textContent = `${totalSellerDeals} closed / ${totalListingAgreements} agreements`;
      document.getElementById('buyerApptConversion').textContent = buyerApptConversionRate.toFixed(1) + '%';
      document.getElementById('buyerApptConversionDetail').textContent = `${totalBuyerContracts} contracts / ${totalBuyerAppts} appointments`;
      document.getElementById('listingApptConversion').textContent = listingApptConversionRate.toFixed(1) + '%';
      document.getElementById('listingApptConversionDetail').textContent = `${totalListingAgreements} agreements / ${totalListingAppts} appointments`;
      document.getElementById('callAnswerRate').textContent = callAnswerRate.toFixed(1) + '%';
      document.getElementById('callAnswerRateDetail').textContent = `${totalCallsAnswered} answered / ${totalCallsMade} made`;
    }
    
    // Goals management
    function updateGoals() {
      goals = {
        daily: {
          calls: parseInt(document.getElementById('dailyCalls').value) || 0,
          hours: parseInt(document.getElementById('dailyHours').value) || 0,
          appointments: parseInt(document.getElementById('dailyAppointments').value) || 0,
          offersWritten: parseInt(document.getElementById('dailyOffers').value) || 0,
          listingAgreements: parseInt(document.getElementById('dailyListingAgreements').value) || 0,
          buyerContracts: parseInt(document.getElementById('dailyBuyerContracts').value) || 0
        },
        weekly: {
          calls: parseInt(document.getElementById('weeklyCalls').value) || 0,
          hours: parseInt(document.getElementById('weeklyHours').value) || 0,
          appointments: parseInt(document.getElementById('weeklyAppointments').value) || 0,
          offersWritten: parseInt(document.getElementById('weeklyOffers').value) || 0,
          listingAgreements: parseInt(document.getElementById('weeklyListingAgreements').value) || 0,
          buyerContracts: parseInt(document.getElementById('weeklyBuyerContracts').value) || 0
        },
        monthly: {
          calls: parseInt(document.getElementById('monthlyCalls').value) || 0,
          hours: parseInt(document.getElementById('monthlyHours').value) || 0,
          appointments: parseInt(document.getElementById('monthlyAppointments').value) || 0,
          offersWritten: parseInt(document.getElementById('monthlyOffers').value) || 0,
          listingAgreements: parseInt(document.getElementById('monthlyListingAgreements').value) || 0,
          buyerContracts: parseInt(document.getElementById('monthlyBuyerContracts').value) || 0
        }
      };
      
      localStorage.setItem('goals', JSON.stringify(goals));
      updateGoalsDisplay();
    }
    
    function updateGoalsDisplay() {
      const today = new Date().toISOString().split('T')[0];
      const todayData = dailyInputs[today] || {};
      
      // Calculate daily progress
      const dailyProgress = {
        calls: goals.daily.calls > 0 ? ((todayData.callsMade || 0) / goals.daily.calls) * 100 : 0,
        hours: goals.daily.hours > 0 ? ((todayData.hoursWorked || 0) / goals.daily.hours) * 100 : 0,
        appointments: goals.daily.appointments > 0 ? (((todayData.listingAppts || 0) + (todayData.buyerAppts || 0)) / goals.daily.appointments) * 100 : 0,
        offersWritten: goals.daily.offersWritten > 0 ? ((todayData.offersWritten || 0) / goals.daily.offersWritten) * 100 : 0,
        listingAgreements: goals.daily.listingAgreements > 0 ? ((todayData.listingAgreements || 0) / goals.daily.listingAgreements) * 100 : 0,
        buyerContracts: goals.daily.buyerContracts > 0 ? ((todayData.buyerContracts || 0) / goals.daily.buyerContracts) * 100 : 0
      };
      
      // Update daily progress display
      const dailyProgressContainer = document.getElementById('dailyProgress');
      dailyProgressContainer.innerHTML = '';
      
      Object.entries(dailyProgress).forEach(([key, value]) => {
        const tile = document.createElement('div');
        tile.className = 'tile';
        const currentValue = todayData[key === 'appointments' ? 'listingAppts' : key] || 0;
        const appointmentValue = key === 'appointments' ? (todayData.listingAppts || 0) + (todayData.buyerAppts || 0) : currentValue;
        
        tile.innerHTML = `
          <div class="progress-wheel">
            <svg viewBox="0 0 120 120">
              <circle class="bg" cx="60" cy="60" r="50"/>
              <circle class="progress" cx="60" cy="60" r="50" 
                      stroke-dasharray="314.16" 
                      stroke-dashoffset="${314.16 - (314.16 * Math.min(value, 100)) / 100}"/>
              <text x="60" y="65" text-anchor="middle" class="progress-text">${Math.round(value)}%</text>
            </svg>
          </div>
          <h4>${key.charAt(0).toUpperCase() + key.slice(1)}</h4>
          <p>${key === 'appointments' ? appointmentValue : currentValue} / ${goals.daily[key]}</p>
        `;
        
        dailyProgressContainer.appendChild(tile);
      });
      
      // Similar calculations for weekly and monthly would go here
      // For brevity, I'll just show the structure
    }
    
    // Calendar functions
    function updateCalendar() {
      const calendarGrid = document.getElementById('calendarGrid');
      const monthHeader = document.getElementById('calendarMonth');
      
      monthHeader.textContent = currentCalendarDate.toLocaleDateString('en-US', { 
        month: 'long', 
        year: 'numeric' 
      });
      
      calendarGrid.innerHTML = '';
      
      // Add day headers
      const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      dayHeaders.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.className = 'calendar-day';
        dayHeader.textContent = day;
        dayHeader.style.fontWeight = 'bold';
        dayHeader.style.backgroundColor = '#C5A95E';
        dayHeader.style.color = 'white';
        calendarGrid.appendChild(dayHeader);
      });
      
      // Generate calendar days
      const firstDay = new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth(), 1);
      const lastDay = new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth() + 1, 0);
      const startDate = new Date(firstDay);
      startDate.setDate(startDate.getDate() - firstDay.getDay());
      
      for (let i = 0; i < 42; i++) {
        const currentDate = new Date(startDate);
        currentDate.setDate(startDate.getDate() + i);
        
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        dayElement.textContent = currentDate.getDate();
        
        const dateString = currentDate.toISOString().split('T')[0];
        const today = new Date().toISOString().split('T')[0];
        
        if (dateString === today) {
          dayElement.classList.add('today');
        }
        
        if (dailyInputs[dateString]) {
          dayElement.classList.add('has-data');
          dayElement.title = 'Has data';
        }
        
        if (currentDate.getMonth() !== currentCalendarDate.getMonth()) {
          dayElement.style.opacity = '0.3';
        }
        
        dayElement.onclick = () => {
          updateSelectedDate(dateString);
          document.getElementById('dailyDate').value = dateString;
        };
        
        calendarGrid.appendChild(dayElement);
      }
    }
    
    function changeMonth(direction) {
      currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
      updateCalendar();
    }
    
    // Performance tab functions
    function updatePerformanceTab() {
      updateActivityInsights();
      updateConversionInsights();
      updatePipelineInsights();
      updateLeadSourcePerformance();
      updateMonthlyBreakdown();
    }
    
    function updateActivityInsights() {
      const container = document.getElementById('activityInsights');
      const totalDays = Object.keys(dailyInputs).length;
      const avgCallsPerDay = totalDays > 0 ? Object.values(dailyInputs).reduce((sum, day) => sum + (day.callsMade || 0), 0) / totalDays : 0;
      const avgHoursPerDay = totalDays > 0 ? Object.values(dailyInputs).reduce((sum, day) => sum + (day.hoursWorked || 0), 0) / totalDays : 0;
      
      const insights = [];
      if (avgCallsPerDay < 20) insights.push('Consider increasing daily call volume for better lead generation');
      if (avgHoursPerDay < 6) insights.push('Working more hours daily could improve overall performance');
      if (totalDays < 30) insights.push('Maintain consistent daily tracking for better insights');
      
      container.innerHTML = insights.length > 0 ? 
        insights.map(insight => `<p>‚Ä¢ ${insight}</p>`).join('') : 
        '<p style="color: #28a745;">‚úÖ Excellent activity levels and tracking!</p>';
    }
    
    function updateConversionInsights() {
      const container = document.getElementById('conversionInsights');
      // Add conversion insights logic here
      container.innerHTML = '<p>Conversion insights will be calculated based on your data.</p>';
    }
    
    function updatePipelineInsights() {
      const container = document.getElementById('pipelineInsights');
      const activeDeals = contractTransactions.filter(t => ['Under Contract', 'Pending'].includes(t.status)).length;
      const totalValue = contractTransactions.filter(t => ['Under Contract', 'Pending'].includes(t.status)).reduce((sum, t) => sum + (t.price || 0), 0);
      
      container.innerHTML = `
        <p><strong>Active Deals:</strong> ${activeDeals}</p>
        <p><strong>Pipeline Value:</strong> $${totalValue.toLocaleString()}</p>
        <p><strong>Potential Commission:</strong> $${(totalValue * 0.025).toLocaleString()}</p>
      `;
    }
    
    function updateLeadSourcePerformance() {
      const container = document.getElementById('leadSourceGrid');
      const leadSources = {};
      
      properties.forEach(prop => {
        const source = prop.leadSource || 'Unknown';
        if (!leadSources[source]) {
          leadSources[source] = { count: 0, commission: 0 };
        }
        leadSources[source].count++;
        if (closedDeals.find(deal => deal.id === prop.id)) {
          leadSources[source].commission += prop.commission || 0;
        }
      });
      
      container.innerHTML = Object.entries(leadSources).map(([source, data]) => `
        <div class="tile">
          <h4>${source}</h4>
          <p>${data.count}</p>
          <small>$${data.commission.toLocaleString()} commission</small>
        </div>
      `).join('');
    }
    
    function updateMonthlyBreakdown() {
      const container = document.getElementById('monthlyBreakdown');
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      
      const monthlyData = months.map((month, index) => {
        const monthlyInputs = Object.values(dailyInputs).filter(day => {
          if (!day.date) return false;
          const dayMonth = new Date(day.date).getMonth();
          return dayMonth === index;
        });
        
        const monthlyCommission = closedDeals.filter(deal => {
          if (!deal.closedDate) return false;
          const dealMonth = new Date(deal.closedDate).getMonth();
          return dealMonth === index;
        }).reduce((sum, deal) => sum + (deal.commission || 0), 0);
        
        return {
          month,
          calls: monthlyInputs.reduce((sum, day) => sum + (day.callsMade || 0), 0),
          hours: monthlyInputs.reduce((sum, day) => sum + (day.hoursWorked || 0), 0),
          commission: monthlyCommission
        };
      });
      
      container.innerHTML = `
        <div class="grid">
          ${monthlyData.map(data => `
            <div class="tile">
              <h4>${data.month}</h4>
              <p>$${data.commission.toLocaleString()}</p>
              <small>${data.calls} calls, ${data.hours}h</small>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    // Settings functions
    function loadAppSettings() {
      document.getElementById('appName').value = appSettings.appName || 'Real Estate KPI Dashboard';
      document.getElementById('hourlyRate').value = appSettings.hourlyRate || 50;
      document.getElementById('reportEmail').value = appSettings.reportEmail || 'nhcazateam@gmail.com';
      document.getElementById('gciGoal').value = appSettings.gciGoal || 215000;
      document.getElementById('avgSale').value = appSettings.avgSale || 325090;
      document.getElementById('avgCommission').value = appSettings.avgCommission || 2.5;
    }
    
    function updateAppName() {
      appSettings.appName = document.getElementById('appName').value;
      localStorage.setItem('appSettings', JSON.stringify(appSettings));
    }
    
    function updateHourlyRate() {
      appSettings.hourlyRate = parseFloat(document.getElementById('hourlyRate').value) || 50;
      localStorage.setItem('appSettings', JSON.stringify(appSettings));
    }
    
    function updateReportEmail() {
      appSettings.reportEmail = document.getElementById('reportEmail').value;
      localStorage.setItem('appSettings', JSON.stringify(appSettings));
    }
    
    function updateGCISettings() {
      appSettings.gciGoal = parseFloat(document.getElementById('gciGoal').value) || 215000;
      appSettings.avgSale = parseFloat(document.getElementById('avgSale').value) || 325090;
      appSettings.avgCommission = parseFloat(document.getElementById('avgCommission').value) || 2.5;
      localStorage.setItem('appSettings', JSON.stringify(appSettings));
    }
    
    // Report functions
    function generateDailyReport() {
      const today = new Date().toISOString().split('T')[0];
      const todayData = dailyInputs[today] || {};
      
      const report = {
        date: today,
        hoursWorked: todayData.hoursWorked || 0,
        callsMade: todayData.callsMade || 0,
        callsAnswered: todayData.callsAnswered || 0,
        appointments: (todayData.listingAppts || 0) + (todayData.buyerAppts || 0),
        offersWritten: todayData.offersWritten || 0,
        listingAgreements: todayData.listingAgreements || 0,
        buyerContracts: todayData.buyerContracts || 0
      };
      
      const subject = `Daily Real Estate Report - ${new Date().toLocaleDateString()}`;
      const body = `Daily Real Estate Activity Report

Date: ${new Date().toLocaleDateString()}

DAILY ACTIVITY:
‚Ä¢ Hours Worked: ${report.hoursWorked}
‚Ä¢ Calls Made: ${report.callsMade}
‚Ä¢ Calls Answered: ${report.callsAnswered}
‚Ä¢ Appointments: ${report.appointments}
‚Ä¢ Offers Written: ${report.offersWritten}
‚Ä¢ Listing Agreements: ${report.listingAgreements}
‚Ä¢ Buyer Contracts: ${report.buyerContracts}

Generated automatically by KPI Dashboard`;
      
      const mailtoLink = `mailto:${appSettings.reportEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      window.open(mailtoLink);
    }
    
    function generateWeeklyReport() {
      alert('Weekly report generation - would open email client with weekly summary');
    }
    
    function generateMonthlyReport() {
      alert('Monthly report generation - would open email client with monthly summary');
    }
    
    function testEmailConnection() {
      alert('Email connection test - would verify email settings');
    }
    
    // Data management functions
    function clearAllData() {
      if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
        localStorage.clear();
        location.reload();
      }
    }
    
    function exportData() {
      const data = {
        properties,
        contractTransactions,
        closedDeals,
        dailyInputs,
        goals,
        appSettings
      };
      
      const dataStr = JSON.stringify(data, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'kpi-dashboard-data.json';
      link.click();
      URL.revokeObjectURL(url);
    }
    
    function importData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            try {
              const data = JSON.parse(e.target.result);
              if (confirm('Import data? This will replace all current data.')) {
                Object.assign(window, data);
                Object.entries(data).forEach(([key, value]) => {
                  localStorage.setItem(key, JSON.stringify(value));
                });
                location.reload();
              }
            } catch (error) {
              alert('Error importing data: ' + error.message);
            }
          };
          reader.readAsText(file);
        }
      };
      input.click();
    }
  </script>
</body>
</html>
