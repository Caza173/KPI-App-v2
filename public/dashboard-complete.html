<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate KPI Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f4f4f4;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .header-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .theme-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background-color 0.3s;
        }

        .theme-toggle:hover {
            background-color: rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .timestamp {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        /* Dark mode styles */
        .dark-mode {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }

        .dark-mode .container {
            background: #2d2d2d;
        }

        .dark-mode .header h1 {
            color: #e0e0e0;
        }

        .dark-mode .timestamp {
            color: #b0b0b0;
        }

        .dark-mode .tab {
            background: #3a3a3a;
            color: #e0e0e0;
            border-bottom: 3px solid #555;
        }

        .dark-mode .tab.active {
            background: #4a4a4a;
            border-bottom: 3px solid #3498db;
        }

        .dark-mode .tab:hover {
            background: #4a4a4a;
        }

        .dark-mode .card {
            background: #3a3a3a;
            border: 1px solid #555;
        }

        .dark-mode .card h3 {
            color: #e0e0e0;
        }

        .dark-mode .form-section {
            background: #3a3a3a;
            border: 1px solid #555;
        }

        .dark-mode .form-section h3 {
            color: #e0e0e0;
        }

        .dark-mode input,
        .dark-mode select,
        .dark-mode textarea {
            background: #4a4a4a;
            color: #e0e0e0;
            border: 1px solid #666;
        }

        .dark-mode input:focus,
        .dark-mode select:focus,
        .dark-mode textarea:focus {
            border-color: #3498db;
        }

        .dark-mode .table {
            background: #3a3a3a;
        }

        .dark-mode .table th {
            background: #4a4a4a;
            color: #e0e0e0;
            border-bottom: 1px solid #666;
        }

        .dark-mode .table td {
            border-bottom: 1px solid #666;
            color: #e0e0e0;
        }

        .dark-mode .table tr:hover {
            background: #4a4a4a;
        }

        .dark-mode .modal-content {
            background: #2d2d2d;
            color: #e0e0e0;
        }

        .dark-mode .close {
            color: #b0b0b0;
        }

        .dark-mode .close:hover {
            color: #e0e0e0;
        }

        .dark-mode .theme-toggle:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            border-bottom: 3px solid #3498db;
            margin-bottom: 30px;
            gap: 5px;
        }

        .tab {
            padding: 15px 20px;
            background: #ecf0f1;
            border: none;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .tab:hover {
            background: #d5dbdb;
        }

        .tab.active {
            background: #3498db;
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .card .number {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 10px;
        }

        .card .label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            background: #3498db;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 0.5s ease;
            border-radius: 15px;
        }

        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        #expensesTable {
            font-size: 14px;
        }

        #expensesTable th {
            font-size: 13px;
            white-space: nowrap;
        }

        #expensesTable td {
            font-size: 13px;
            padding: 8px;
            vertical-align: middle;
        }

        #expensesTable .action-btn {
            font-size: 12px;
            padding: 4px 8px;
            margin: 0 2px;
        }

        .expense-summary {
            text-align: left;
            font-size: 14px;
            line-height: 1.4;
        }

        .expense-summary div {
            margin: 5px 0;
        }

        #expensesByProperty .card {
            min-height: 160px;
        }

        #expensesByProperty .card h4 {
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 16px;
        }

        /* Modal styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: none;
            border-radius: 10px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .view-btn {
            background: #17a2b8;
            color: white;
        }

        .view-btn:hover {
            background: #138496;
        }

        .status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status.active {
            background: #d4edda;
            color: #155724;
        }

        .status.sold {
            background: #cce5ff;
            color: #004085;
        }

        .status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .status.expired {
            background: #f8d7da;
            color: #721c24;
        }

        .status.withdrawn {
            background: #d3d3d4;
            color: #495057;
        }

        .status.terminated {
            background: #f5c6cb;
            color: #721c24;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 5px;
        }

        .edit-btn {
            background: #ffc107;
            color: #212529;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .save-btn {
            background: #28a745;
            color: white;
        }

        .cancel-btn {
            background: #6c757d;
            color: white;
        }

        .action-btn:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Real Estate KPI Dashboard</h1>
            <div class="header-controls">
                <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()">ðŸŒ™</button>
                <div class="timestamp">Last Updated: <span id="timestamp"></span></div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('goals', this)">Goals</button>
            <button class="tab" onclick="showTab('properties', this)">Properties</button>
            <button class="tab" onclick="showTab('transactions', this)">Transactions</button>
            <button class="tab" onclick="showTab('dashboard', this)">Dashboard</button>
            <button class="tab" onclick="showTab('daily', this)">Daily Data</button>
            <button class="tab" onclick="showTab('expenses', this)">Expenses</button>
            <button class="tab" onclick="showTab('calendar', this)">Calendar</button>
            <button class="tab" onclick="showTab('gci', this)">GCI Calculator</button>
            <button class="tab" onclick="showTab('reports', this)">Reports</button>
        </div>

        <!-- Goals Tab -->
        <div id="goals" class="tab-content active">
            <h2>Goals & Targets</h2>
            <div class="grid">
                <div class="card">
                    <h3>Daily Goal</h3>
                    <div class="number">10</div>
                    <div class="label">Calls per day</div>
                </div>
                <div class="card">
                    <h3>Weekly Goal</h3>
                    <div class="number">5</div>
                    <div class="label">Appointments per week</div>
                </div>
                <div class="card">
                    <h3>Monthly Goal</h3>
                    <div class="number">2</div>
                    <div class="label">Closings per month</div>
                </div>
                <div class="card">
                    <h3>Monthly Offers</h3>
                    <div class="number">15</div>
                    <div class="label">Offers written per month</div>
                </div>
                <div class="card">
                    <h3>Annual GCI</h3>
                    <div class="number">$215K</div>
                    <div class="label">Target commission</div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Update Your Goals</h3>
                <div class="form-group">
                    <label>Daily Call Goal</label>
                    <input type="number" name="dailyCalls" value="10" placeholder="Enter daily call target">
                </div>
                <div class="form-group">
                    <label>Weekly Appointment Goal</label>
                    <input type="number" name="weeklyAppointments" value="5" placeholder="Enter weekly appointment target">
                </div>
                <div class="form-group">
                    <label>Monthly Closing Goal</label>
                    <input type="number" name="monthlyClosings" value="2" placeholder="Enter monthly closing target">
                </div>
                <div class="form-group">
                    <label>Monthly Offers Written Goal</label>
                    <input type="number" name="monthlyOffers" value="15" placeholder="Enter monthly offers target">
                </div>
                <button class="btn">Update Goals</button>
            </div>
        </div>

        <!-- Properties Tab -->
        <div id="properties" class="tab-content">
            <h2>Property Management</h2>
            <div class="grid">
                <div class="card">
                    <h3>Total Properties</h3>
                    <div class="number">15</div>
                    <div class="label">Properties in portfolio</div>
                </div>
                <div class="card">
                    <h3>Active Listings</h3>
                    <div class="number">8</div>
                    <div class="label">Currently active</div>
                </div>
                <div class="card">
                    <h3>Sold Properties</h3>
                    <div class="number">5</div>
                    <div class="label">Successfully sold</div>
                </div>
                <div class="card">
                    <h3>Pending Sales</h3>
                    <div class="number">2</div>
                    <div class="label">Under contract</div>
                </div>
            </div>

            <table class="table" id="propertiesTable">
                <thead>
                    <tr>
                        <th>Address</th>
                        <th>Client</th>
                        <th>Type</th>
                        <th>Price</th>
                        <th>Status</th>
                        <th>Status Note</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Properties will be populated by JavaScript -->
                </tbody>
            </table>

            <div class="form-section">
                <h3>Add New Property</h3>
                <div class="form-group">
                    <label>Property Address</label>
                    <input type="text" name="address" placeholder="Enter property address">
                </div>
                <div class="form-group">
                    <label>Client Name</label>
                    <input type="text" name="client" placeholder="Enter client name">
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select name="type">
                        <option value="Buyer">Buyer</option>
                        <option value="Seller">Seller</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Price</label>
                    <input type="number" name="price" placeholder="Enter price">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select name="status">
                        <option>Active</option>
                        <option>Pending</option>
                        <option>Sold</option>
                        <option>Expired</option>
                        <option>Withdrawn</option>
                        <option>Terminated</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Status Note</label>
                    <textarea name="statusNote" placeholder="Enter status note or reason (optional)" rows="3"></textarea>
                </div>
                <button class="btn">Add Property</button>
            </div>

            <!-- Property Expense Details Modal -->
            <div id="propertyExpenseModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <span class="close" onclick="closePropertyExpenseModal()">&times;</span>
                    <h3 id="propertyExpenseTitle">Property Expense Details</h3>
                    <div id="propertyExpenseDetails"></div>
                </div>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div id="transactions" class="tab-content">
            <h2>Transaction History</h2>
            <div class="grid">
                <div class="card">
                    <h3>Total Transactions</h3>
                    <div class="number">12</div>
                    <div class="label">This year</div>
                </div>
                <div class="card">
                    <h3>Total Volume</h3>
                    <div class="number">$4.2M</div>
                    <div class="label">Transaction volume</div>
                </div>
                <div class="card">
                    <h3>Commission Earned</h3>
                    <div class="number">$105K</div>
                    <div class="label">Total commission</div>
                </div>
                <div class="card">
                    <h3>Average Deal</h3>
                    <div class="number">$350K</div>
                    <div class="label">Average transaction</div>
                </div>
            </div>

            <div class="alert">
                <strong>Great Progress!</strong> You've earned $105,000 in commission so far this year, putting you at 49% of your annual goal.
            </div>

            <table class="table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Property</th>
                        <th>Amount</th>
                        <th>Commission</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>2025-07-15</td>
                        <td>123 Main Street</td>
                        <td>$350,000</td>
                        <td>$8,750</td>
                        <td><span class="status sold">Closed</span></td>
                    </tr>
                    <tr>
                        <td>2025-07-10</td>
                        <td>456 Oak Avenue</td>
                        <td>$425,000</td>
                        <td>$10,625</td>
                        <td><span class="status sold">Closed</span></td>
                    </tr>
                    <tr>
                        <td>2025-07-05</td>
                        <td>789 Pine Road</td>
                        <td>$275,000</td>
                        <td>$6,875</td>
                        <td><span class="status pending">Pending</span></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content">
            <h2>Dashboard Overview</h2>
            <div class="grid">
                <div class="card">
                    <h3>Today's Calls</h3>
                    <div class="number">8</div>
                    <div class="label">Calls made today</div>
                </div>
                <div class="card">
                    <h3>Appointments</h3>
                    <div class="number">3</div>
                    <div class="label">Scheduled today</div>
                </div>
                <div class="card">
                    <h3>ROI</h3>
                    <div class="number" id="roiPercentage">275%</div>
                    <div class="label">Return on Investment</div>
                </div>
                <div class="card">
                    <h3>Monthly Offers Written</h3>
                    <div class="number" id="monthlyOffersWritten">12</div>
                    <div class="label">Offers this month</div>
                </div>
                <div class="card">
                    <h3>Efficiency Score</h3>
                    <div class="number" id="efficiencyScore">85%</div>
                    <div class="label">Goal achievement rate</div>
                </div>
                <div class="card">
                    <h3>Conversion Rate</h3>
                    <div class="number">25%</div>
                    <div class="label">Leads to appointments</div>
                </div>
                <div class="card">
                    <h3>Monthly Progress</h3>
                    <div class="number">67%</div>
                    <div class="label">Toward monthly goal</div>
                </div>
            </div>

            <div class="alert">
                <strong>Daily Summary:</strong> You've made 8 calls today with a 75% answer rate. You have 3 appointments scheduled and are on track to meet your monthly goals.
            </div>
        </div>

        <!-- Daily Data Tab -->
        <div id="daily" class="tab-content">
            <h2>Daily Data Entry</h2>
            <div class="form-section">
                <h3>Enter Today's Activity</h3>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" name="date" id="dailyDate">
                </div>
                <div class="form-group">
                    <label>Hours Worked</label>
                    <input type="number" name="hours" placeholder="Enter hours worked">
                </div>
                <div class="form-group">
                    <label>Calls Made</label>
                    <input type="number" name="calls" placeholder="Enter calls made">
                </div>
                <div class="form-group">
                    <label>Calls Answered</label>
                    <input type="number" name="answered" placeholder="Enter calls answered">
                </div>
                <div class="form-group">
                    <label>Appointments Set</label>
                    <input type="number" name="appointments" placeholder="Enter appointments set">
                </div>
                <div class="form-group">
                    <label>Offers Written</label>
                    <input type="number" name="offers" placeholder="Enter offers written">
                </div>
                <button class="btn">Save Daily Data</button>
            </div>
        </div>

        <!-- Expenses Tab -->
        <div id="expenses" class="tab-content">
            <h2>Expense Tracking</h2>
            
            <!-- Tile Selection Controls -->
            <div class="form-section" style="margin-bottom: 20px;">
                <h3>Select Categories to Display</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 15px;">
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="showTotalExpenses" checked onchange="toggleExpenseTile('totalExpenses')">
                        Total Expenses
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="showMarketing" checked onchange="toggleExpenseTile('marketing')">
                        Marketing
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="showHoursWorked" checked onchange="toggleExpenseTile('hoursWorked')">
                        Hours Worked
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="showMileage" checked onchange="toggleExpenseTile('mileage')">
                        Mileage
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="showMeals" onchange="toggleExpenseTile('meals')">
                        Meals
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="showEquipment" onchange="toggleExpenseTile('equipment')">
                        Equipment
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="showOffice" onchange="toggleExpenseTile('office')">
                        Office
                    </label>
                </div>
            </div>

            <div class="grid" id="expenseGrid">
                <div class="card" id="totalExpenses">
                    <h3>Total Expenses</h3>
                    <div class="number" id="totalExpensesAmount">$2,450</div>
                    <div class="label">This month</div>
                </div>
                <div class="card" id="marketing">
                    <h3>Marketing</h3>
                    <div class="number" id="marketingAmount">$1,200</div>
                    <div class="label">Marketing expenses</div>
                </div>
                <div class="card" id="hoursWorked">
                    <h3>Hours Worked</h3>
                    <div class="number" id="hoursWorkedAmount">12.0</div>
                    <div class="label">Total hours worked</div>
                </div>
                <div class="card" id="mileage">
                    <h3>Mileage</h3>
                    <div class="number" id="mileageAmount">190.0</div>
                    <div class="label">Miles driven</div>
                </div>
                <div class="card" id="meals" style="display: none;">
                    <h3>Meals</h3>
                    <div class="number" id="mealsAmount">$450</div>
                    <div class="label">Meal expenses</div>
                </div>
                <div class="card" id="equipment" style="display: none;">
                    <h3>Equipment</h3>
                    <div class="number" id="equipmentAmount">$300</div>
                    <div class="label">Equipment rental</div>
                </div>
                <div class="card" id="office" style="display: none;">
                    <h3>Office</h3>
                    <div class="number" id="officeAmount">$150</div>
                    <div class="label">Office supplies</div>
                </div>
            </div>

            <div class="form-section">
                <h3>Add New Expense</h3>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" name="date" id="expenseDate">
                </div>
                <div class="form-group">
                    <label>Property</label>
                    <select name="property" id="expenseProperty">
                        <option value="">Select Property (Optional)</option>
                        <!-- Properties will be populated by JavaScript -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select name="category" id="expenseCategory">
                        <option>Marketing</option>
                        <option>Meals</option>
                        <option>Professional Photography</option>
                        <option>Staging</option>
                        <option>Junk Removal</option>
                        <option>Cleaner</option>
                        <option>Mileage</option>
                        <option>Equipment Rental</option>
                        <option>Office</option>
                        <option>Professional Development</option>
                        <option>Appraisal</option>
                        <option>Office Meeting</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Amount</label>
                    <input type="number" name="amount" id="expenseAmount" placeholder="Enter amount" step="0.01">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" name="description" id="expenseDescription" placeholder="Enter description">
                </div>
                <div class="form-group">
                    <label>Mileage (miles)</label>
                    <input type="number" name="mileage" id="expenseMileage" placeholder="Enter mileage" step="0.1" onchange="calculateMileageCost()">
                </div>
                <div class="form-group">
                    <label>Gas Price (per gallon)</label>
                    <input type="number" name="gasPrice" id="expenseGasPrice" placeholder="Enter current gas price" step="0.01" onchange="calculateMileageCost()">
                </div>
                <div class="form-group">
                    <label>Miles Per Gallon (MPG)</label>
                    <input type="number" name="mpg" id="expenseMPG" placeholder="Enter your car's MPG" step="0.1" value="20" onchange="calculateMileageCost()">
                </div>
                <div class="form-group">
                    <label>Calculated Mileage Cost</label>
                    <input type="number" name="mileageCost" id="expenseMileageCost" placeholder="Auto-calculated" step="0.01" readonly>
                </div>
                <div class="form-group">
                    <label>Travel Hours</label>
                    <input type="number" name="travelHours" id="expenseTravelHours" step="0.25" placeholder="Enter travel hours">
                </div>
                <div class="form-group">
                    <label>Hours Worked</label>
                    <input type="number" name="hoursWorked" id="expenseHoursWorked" step="0.25" placeholder="Enter hours worked on this task">
                </div>
                <div class="form-group">
                    <label>Hourly Rate ($)</label>
                    <input type="number" name="hourlyRate" id="expenseHourlyRate" step="0.01" placeholder="Enter hourly rate">
                </div>
                <button class="btn" onclick="addExpense()">Add Expense</button>
            </div>

            <div class="form-section">
                <h3>Expense History</h3>
                <table class="table" id="expensesTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Property</th>
                            <th>Category</th>
                            <th>Amount</th>
                            <th>Description</th>
                            <th>Mileage</th>
                            <th>Gas Price</th>
                            <th>MPG</th>
                            <th>Mileage Cost</th>
                            <th>Travel Hours</th>
                            <th>Hours Worked</th>
                            <th>Hourly Rate</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Expenses will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <div class="form-section">
                <h3>Expense Summary by Property</h3>
                <div id="expensesByProperty">
                    <!-- Property expense summaries will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Calendar Tab -->
        <div id="calendar" class="tab-content">
            <h2>Calendar & Activity Tracking</h2>
            <div class="grid">
                <div class="card">
                    <h3>Property Showings</h3>
                    <div class="number">5</div>
                    <div class="label">This month</div>
                </div>
                <div class="card">
                    <h3>Listing Presentations</h3>
                    <div class="number">8</div>
                    <div class="label">This month</div>
                </div>
                <div class="card">
                    <h3>Buyer Consultations</h3>
                    <div class="number">12</div>
                    <div class="label">This month</div>
                </div>
                <div class="card">
                    <h3>Closings</h3>
                    <div class="number">3</div>
                    <div class="label">This month</div>
                </div>
            </div>

            <div class="form-section">
                <h3>Add Activity</h3>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="activityDate" name="activityDate">
                </div>
                <div class="form-group">
                    <label>Activity Type</label>
                    <select id="activityType" name="activityType">
                        <option>Property Showing</option>
                        <option>Listing Presentation</option>
                        <option>Buyer Consultation</option>
                        <option>Closing</option>
                        <option>Open House</option>
                        <option>Property Inspection</option>
                        <option>Market Analysis</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Client Name</label>
                    <input type="text" id="activityClient" name="activityClient" placeholder="Enter client name">
                </div>
                <div class="form-group">
                    <label>Property Address (Optional)</label>
                    <input type="text" id="activityProperty" name="activityProperty" placeholder="Enter property address">
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="activityNotes" name="activityNotes" placeholder="Enter activity notes" rows="3"></textarea>
                </div>
                <button class="btn" onclick="addActivity()">Add Activity</button>
            </div>

            <div class="form-section">
                <h3>Activity History</h3>
                <table class="table" id="activitiesTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Client</th>
                            <th>Property</th>
                            <th>Notes</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Activities will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- GCI Calculator Tab -->
        <div id="gci" class="tab-content">
            <h2>GCI Calculator</h2>
            <div class="grid">
                <div class="card">
                    <h3>Annual Goal</h3>
                    <div class="number">$215K</div>
                    <div class="label">GCI target</div>
                </div>
                <div class="card">
                    <h3>Current GCI</h3>
                    <div class="number">$105K</div>
                    <div class="label">Year-to-date</div>
                </div>
                <div class="card">
                    <h3>Remaining</h3>
                    <div class="number">$110K</div>
                    <div class="label">Still needed</div>
                </div>
                <div class="card">
                    <h3>Progress</h3>
                    <div class="number">49%</div>
                    <div class="label">Toward goal</div>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" style="width: 49%"></div>
            </div>
            <p style="text-align: center; margin-top: 10px; font-weight: 600;">49% Complete - $105,000 of $215,000 goal</p>

            <div class="form-section">
                <h3>GCI Projection</h3>
                <div class="form-group">
                    <label>Average Sale Price</label>
                    <input type="number" id="avgPrice" value="350000" placeholder="Enter average sale price">
                </div>
                <div class="form-group">
                    <label>Commission Rate (%)</label>
                    <input type="number" id="commissionRate" value="2.5" step="0.1" placeholder="Enter commission rate">
                </div>
                <div class="form-group">
                    <label>Annual GCI Goal</label>
                    <input type="number" id="gciGoal" value="215000" placeholder="Enter annual GCI goal">
                </div>
                <div class="form-group">
                    <label>Deals Needed</label>
                    <input type="number" id="dealsNeeded" value="13" readonly>
                </div>
                <button class="btn" onclick="calculateGCI()">Recalculate</button>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <h2>Reports & Analytics</h2>
            <div class="grid">
                <div class="card">
                    <h3>Conversion Rate</h3>
                    <div class="number">25%</div>
                    <div class="label">Leads to appointments</div>
                </div>
                <div class="card">
                    <h3>Average Days on Market</h3>
                    <div class="number">32</div>
                    <div class="label">Days to sell</div>
                </div>
            </div>

            <div class="form-section">
                <h3>Generate Report</h3>
                <div class="form-group">
                    <label>Report Type</label>
                    <select id="reportType">
                        <option value="weekly">Weekly Summary</option>
                        <option value="monthly">Monthly Summary</option>
                        <option value="quarterly">Quarterly Review</option>
                        <option value="annual">Annual Report</option>
                        <option value="commission">Commission Summary</option>
                        <option value="expense">Expense Report</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>From Date</label>
                    <input type="date" id="reportFromDate">
                </div>
                <div class="form-group">
                    <label>To Date</label>
                    <input type="date" id="reportToDate">
                </div>
                <button class="btn" onclick="generateReport()">Generate Report</button>
            </div>
        </div>
    </div>

    <script>
        // Data storage and management
        let dashboardData = {
            goals: {
                daily: { calls: 10, appointments: 5, closings: 2 },
                weekly: { calls: 70, appointments: 25, closings: 10 },
                monthly: { calls: 300, appointments: 100, closings: 40, offersWritten: 15 },
                annual: { gci: 215000 }
            },
            properties: [
                { id: 1, address: '123 Main Street', client: 'John Doe', type: 'Seller', price: 350000, status: 'Active', statusNote: '' },
                { id: 2, address: '456 Oak Avenue', client: 'Jane Smith', type: 'Seller', price: 425000, status: 'Sold', statusNote: '' },
                { id: 3, address: '789 Pine Road', client: 'Bob Johnson', type: 'Seller', price: 275000, status: 'Sold', statusNote: '' },
                { id: 4, address: '437 Berry Rd Alexandria NH 03222', client: 'Corey Caza', type: 'Seller', price: 500000, status: 'Sold', statusNote: '' },
                { id: 5, address: '123 Main St Concord', client: 'Amy', type: 'Buyer', price: 1000000, status: 'Sold', statusNote: '' }
            ],
            offersWritten: [
                { id: 1, date: '2025-07-15', property: '123 Main Street', offerAmount: 340000, status: 'Pending' },
                { id: 2, date: '2025-07-10', property: '456 Oak Avenue', offerAmount: 420000, status: 'Accepted' },
                { id: 3, date: '2025-07-05', property: '789 Pine Road', offerAmount: 270000, status: 'Accepted' }
            ],
            transactions: [
                { id: 1, date: '2025-07-15', property: '123 Main Street', amount: 350000, commission: 8750, status: 'Closed' },
                { id: 2, date: '2025-07-10', property: '456 Oak Avenue', amount: 425000, commission: 10625, status: 'Closed' },
                { id: 3, date: '2025-07-05', property: '789 Pine Road', amount: 275000, commission: 6875, status: 'Closed' }
            ],
            dailyData: {},
            expenses: [
                { id: 1, date: '2025-07-01', property: '123 Main Street', category: 'Marketing', amount: 1200, description: 'Social media ads', mileage: 0, gasPrice: 0, mpg: 20, mileageCost: 0, travelHours: 0, hoursWorked: 2, hourlyRate: 50 },
                { id: 2, date: '2025-07-02', property: '456 Oak Avenue', category: 'Mileage', amount: 650, description: 'Client visits', mileage: 150, gasPrice: 3.45, mpg: 20, mileageCost: 25.88, travelHours: 3, hoursWorked: 4, hourlyRate: 75 },
                { id: 3, date: '2025-07-03', property: '', category: 'Office', amount: 600, description: 'Office supplies', mileage: 0, gasPrice: 0, mpg: 20, mileageCost: 0, travelHours: 0, hoursWorked: 1, hourlyRate: 0 },
                { id: 4, date: '2025-07-04', property: '789 Pine Road', category: 'Professional Photography', amount: 450, description: 'Property photos', mileage: 25, gasPrice: 3.42, mpg: 20, mileageCost: 4.28, travelHours: 0.5, hoursWorked: 2, hourlyRate: 125 },
                { id: 5, date: '2025-07-05', property: '123 Main Street', category: 'Staging', amount: 800, description: 'Home staging', mileage: 15, gasPrice: 3.40, mpg: 20, mileageCost: 2.55, travelHours: 0.25, hoursWorked: 3, hourlyRate: 60 }
            ],
            appointments: [
                { id: 1, date: '2025-07-16', time: '14:00', client: 'John Doe', type: 'Property Showing' },
                { id: 2, date: '2025-07-16', time: '16:00', client: 'Jane Smith', type: 'Listing Presentation' },
                { id: 3, date: '2025-07-17', time: '10:00', client: 'Bob Johnson', type: 'Buyer Consultation' }
            ],
            activities: [
                { id: 1, date: '2025-07-01', type: 'Property Showing', client: 'John Doe', property: '123 Main Street', notes: 'Showed property to interested buyer' },
                { id: 2, date: '2025-07-02', type: 'Listing Presentation', client: 'Jane Smith', property: '456 Oak Avenue', notes: 'Presented listing proposal' },
                { id: 3, date: '2025-07-03', type: 'Buyer Consultation', client: 'Bob Johnson', property: '', notes: 'Initial buyer consultation meeting' },
                { id: 4, date: '2025-07-04', type: 'Closing', client: 'Mary Wilson', property: '789 Pine Road', notes: 'Successful closing' },
                { id: 5, date: '2025-07-05', type: 'Property Showing', client: 'Tom Brown', property: '123 Main Street', notes: 'Second showing for same property' }
            ]
        };

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('dashboardData');
            if (saved) {
                dashboardData = { ...dashboardData, ...JSON.parse(saved) };
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('dashboardData', JSON.stringify(dashboardData));
        }

        // Update dashboard displays
        function updateDashboard() {
            updateGoalsDisplay();
            updatePropertiesDisplay();
            updateTransactionsDisplay();
            updateExpensesDisplay();
            updateCalendarDisplay();
            updateGCIDisplay();
            updateDashboardTiles();
        }

        function updateDashboardTiles() {
            // Update Monthly Offers Written
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const monthlyOffers = dashboardData.offersWritten.filter(offer => {
                const offerDate = new Date(offer.date);
                return offerDate.getMonth() === currentMonth && offerDate.getFullYear() === currentYear;
            });
            
            const monthlyOffersElement = document.getElementById('monthlyOffersWritten');
            if (monthlyOffersElement) {
                monthlyOffersElement.textContent = monthlyOffers.length;
            }
            
            // Calculate and update ROI
            const roi = calculateROI();
            const roiElement = document.getElementById('roiPercentage');
            if (roiElement) {
                roiElement.textContent = roi + '%';
            }
            
            // Calculate and update Efficiency Score
            const efficiencyScore = calculateEfficiencyScore();
            const efficiencyElement = document.getElementById('efficiencyScore');
            if (efficiencyElement) {
                efficiencyElement.textContent = efficiencyScore + '%';
            }
        }

        function calculateROI() {
            const totalExpenses = dashboardData.expenses.reduce((sum, expense) => sum + expense.amount, 0);
            const totalCommissions = dashboardData.transactions.reduce((sum, transaction) => sum + transaction.commission, 0);
            
            if (totalExpenses === 0) return 0;
            
            const roi = ((totalCommissions - totalExpenses) / totalExpenses) * 100;
            return Math.round(roi);
        }

        function calculateEfficiencyScore() {
            const goals = dashboardData.goals;
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            // Get current month's actual data
            const monthlyTransactions = dashboardData.transactions.filter(t => {
                const transDate = new Date(t.date);
                return transDate.getMonth() === currentMonth && transDate.getFullYear() === currentYear;
            });
            
            const monthlyOffers = dashboardData.offersWritten.filter(offer => {
                const offerDate = new Date(offer.date);
                return offerDate.getMonth() === currentMonth && offerDate.getFullYear() === currentYear;
            });
            
            // Calculate achievement percentages
            const closingsAchieved = monthlyTransactions.length;
            const closingsGoal = goals.monthly.closings;
            const closingsScore = Math.min((closingsAchieved / closingsGoal) * 100, 100);
            
            const offersAchieved = monthlyOffers.length;
            const offersGoal = goals.monthly.offersWritten;
            const offersScore = Math.min((offersAchieved / offersGoal) * 100, 100);
            
            // For now, use a simple average. You can add more metrics later
            const overallScore = (closingsScore + offersScore) / 2;
            
            return Math.round(overallScore);
        }

        function updateGoalsDisplay() {
            // Update goal cards with current data
            const goalCards = document.querySelectorAll('#goals .card .number');
            if (goalCards.length >= 4) {
                goalCards[0].textContent = dashboardData.goals.daily.calls;
                goalCards[1].textContent = dashboardData.goals.weekly.appointments;
                goalCards[2].textContent = dashboardData.goals.monthly.closings;
                goalCards[3].textContent = '$' + (dashboardData.goals.annual.gci / 1000) + 'K';
            }
        }

        function updatePropertiesDisplay() {
            const props = dashboardData.properties;
            const activeCount = props.filter(p => p.status === 'Active').length;
            const soldCount = props.filter(p => p.status === 'Sold').length;
            const pendingCount = props.filter(p => p.status === 'Pending').length;

            const propCards = document.querySelectorAll('#properties .card .number');
            if (propCards.length >= 4) {
                propCards[0].textContent = props.length;
                propCards[1].textContent = activeCount;
                propCards[2].textContent = soldCount;
                propCards[3].textContent = pendingCount;
            }

            // Update properties table
            const tbody = document.querySelector('#propertiesTable tbody');
            tbody.innerHTML = '';
            
            props.forEach(property => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td data-field="address">${property.address}</td>
                    <td data-field="client">${property.client}</td>
                    <td data-field="type">${property.type || 'N/A'}</td>
                    <td data-field="price">$${property.price.toLocaleString()}</td>
                    <td data-field="status">
                        <span class="status ${property.status.toLowerCase()}">${property.status}</span>
                    </td>
                    <td data-field="statusNote">${property.statusNote || ''}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editProperty(${property.id})">Edit</button>
                        <button class="action-btn delete-btn" onclick="deleteProperty(${property.id})">Delete</button>
                        <button class="action-btn view-btn" onclick="viewPropertyExpenses('${property.address}')">View Expenses</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateTransactionsDisplay() {
            // Filter transactions for sold/closed properties only
            const closedTransactions = dashboardData.transactions.filter(t => t.status === 'Closed');
            const totalVolume = closedTransactions.reduce((sum, t) => sum + t.amount, 0);
            const totalCommission = closedTransactions.reduce((sum, t) => sum + t.commission, 0);
            const avgDeal = closedTransactions.length > 0 ? totalVolume / closedTransactions.length : 0;

            const transCards = document.querySelectorAll('#transactions .card .number');
            if (transCards.length >= 4) {
                transCards[0].textContent = closedTransactions.length;
                transCards[1].textContent = '$' + (totalVolume / 1000000).toFixed(1) + 'M';
                transCards[2].textContent = '$' + (totalCommission / 1000).toFixed(1) + 'K';
                transCards[3].textContent = '$' + (avgDeal / 1000).toFixed(1) + 'K';
            }
        }

        function updateExpensesDisplay() {
            const expenses = dashboardData.expenses;
            const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0);
            const marketing = expenses.filter(e => e.category === 'Marketing').reduce((sum, e) => sum + e.amount, 0);
            const meals = expenses.filter(e => e.category === 'Meals').reduce((sum, e) => sum + e.amount, 0);
            const equipment = expenses.filter(e => e.category === 'Equipment Rental').reduce((sum, e) => sum + e.amount, 0);
            const office = expenses.filter(e => e.category === 'Office').reduce((sum, e) => sum + e.amount, 0);
            const totalHoursWorked = expenses.reduce((sum, e) => sum + (e.hoursWorked || 0), 0);
            const totalMileage = expenses.reduce((sum, e) => sum + (e.mileage || 0), 0);

            // Update tile values
            const totalExpensesEl = document.getElementById('totalExpensesAmount');
            const marketingEl = document.getElementById('marketingAmount');
            const mealsEl = document.getElementById('mealsAmount');
            const equipmentEl = document.getElementById('equipmentAmount');
            const officeEl = document.getElementById('officeAmount');
            const hoursWorkedEl = document.getElementById('hoursWorkedAmount');
            const mileageEl = document.getElementById('mileageAmount');

            if (totalExpensesEl) totalExpensesEl.textContent = '$' + totalExpenses.toLocaleString();
            if (marketingEl) marketingEl.textContent = '$' + marketing.toLocaleString();
            if (mealsEl) mealsEl.textContent = '$' + meals.toLocaleString();
            if (equipmentEl) equipmentEl.textContent = '$' + equipment.toLocaleString();
            if (officeEl) officeEl.textContent = '$' + office.toLocaleString();
            if (hoursWorkedEl) hoursWorkedEl.textContent = totalHoursWorked.toFixed(1);
            if (mileageEl) mileageEl.textContent = totalMileage.toFixed(1);

            // Update expenses table
            const expensesTableBody = document.querySelector('#expensesTable tbody');
            if (expensesTableBody) {
                expensesTableBody.innerHTML = '';
                
                expenses.forEach(expense => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${expense.date}</td>
                        <td>${expense.property || 'N/A'}</td>
                        <td>${expense.category}</td>
                        <td>$${expense.amount.toLocaleString()}</td>
                        <td>${expense.description}</td>
                        <td>${expense.mileage || 0} miles</td>
                        <td>$${(expense.gasPrice || 0).toFixed(2)}</td>
                        <td>${expense.mpg || 0} MPG</td>
                        <td>$${(expense.mileageCost || 0).toFixed(2)}</td>
                        <td>${expense.travelHours || 0} hrs</td>
                        <td>${expense.hoursWorked || 0} hrs</td>
                        <td>$${(expense.hourlyRate || 0).toFixed(2)}</td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editExpense(${expense.id})">Edit</button>
                            <button class="action-btn delete-btn" onclick="deleteExpense(${expense.id})">Delete</button>
                        </td>
                    `;
                    expensesTableBody.appendChild(row);
                });
            }

            // Update property dropdown in expense form
            const propertySelect = document.getElementById('expenseProperty');
            if (propertySelect) {
                // Clear existing options except the first one
                while (propertySelect.children.length > 1) {
                    propertySelect.removeChild(propertySelect.lastChild);
                }
                
                // Add properties to dropdown
                dashboardData.properties.forEach(property => {
                    const option = document.createElement('option');
                    option.value = property.address;
                    option.textContent = property.address;
                    propertySelect.appendChild(option);
                });
            }

            // Update expense summary by property
            const expensesByPropertyDiv = document.getElementById('expensesByProperty');
            if (expensesByPropertyDiv) {
                const propertyExpenses = {};
                
                // Group expenses by property
                expenses.forEach(expense => {
                    const property = expense.property || 'General/Office';
                    if (!propertyExpenses[property]) {
                        propertyExpenses[property] = {
                            totalAmount: 0,
                            totalMileage: 0,
                            totalTravelHours: 0,
                            totalHoursWorked: 0,
                            expenseCount: 0
                        };
                    }
                    propertyExpenses[property].totalAmount += expense.amount;
                    propertyExpenses[property].totalMileage += expense.mileage || 0;
                    propertyExpenses[property].totalTravelHours += expense.travelHours || 0;
                    propertyExpenses[property].totalHoursWorked += expense.hoursWorked || 0;
                    propertyExpenses[property].expenseCount++;
                });
                
                // Create summary HTML
                let summaryHTML = '<div class="grid">';
                Object.keys(propertyExpenses).forEach(property => {
                    const summary = propertyExpenses[property];
                    summaryHTML += `
                        <div class="card">
                            <h4>${property}</h4>
                            <div class="expense-summary">
                                <div><strong>Total Spent:</strong> $${summary.totalAmount.toLocaleString()}</div>
                                <div><strong>Total Mileage:</strong> ${summary.totalMileage.toFixed(1)} miles</div>
                                <div><strong>Travel Hours:</strong> ${summary.totalTravelHours.toFixed(1)} hrs</div>
                                <div><strong>Work Hours:</strong> ${summary.totalHoursWorked.toFixed(1)} hrs</div>
                                <div><strong>Expense Count:</strong> ${summary.expenseCount}</div>
                            </div>
                        </div>
                    `;
                });
                summaryHTML += '</div>';
                
                expensesByPropertyDiv.innerHTML = summaryHTML;
            }
        }

        function updateCalendarDisplay() {
            const today = new Date().toISOString().split('T')[0];
            const todayAppts = dashboardData.appointments.filter(a => a.date === today).length;
            const weekAppts = dashboardData.appointments.length;

            const calCards = document.querySelectorAll('#calendar .card .number');
            if (calCards.length >= 4) {
                calCards[0].textContent = todayAppts;
                calCards[1].textContent = weekAppts;
                calCards[2].textContent = '92%';
                calCards[3].textContent = '2:00 PM';
            }
        }

        function updateGCIDisplay() {
            const totalCommission = dashboardData.transactions.reduce((sum, t) => sum + t.commission, 0);
            const gciGoal = dashboardData.goals.annual.gci;
            const remaining = gciGoal - totalCommission;
            const progress = (totalCommission / gciGoal) * 100;

            const gciCards = document.querySelectorAll('#gci .card .number');
            if (gciCards.length >= 4) {
                gciCards[0].textContent = '$' + (gciGoal / 1000) + 'K';
                gciCards[1].textContent = '$' + (totalCommission / 1000) + 'K';
                gciCards[2].textContent = '$' + (remaining / 1000) + 'K';
                gciCards[3].textContent = Math.round(progress) + '%';
            }

            // Update progress bar
            const progressBar = document.querySelector('#gci .progress-fill');
            if (progressBar) {
                progressBar.style.width = progress + '%';
            }
        }

        // Tab switching functionality
        function showTab(tabName, element) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });

            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab content
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            // Add active class to clicked tab
            if (element) {
                element.classList.add('active');
            }
        }

        // Handle form submissions
        function handleFormSubmission(formType, form) {
            let success = false;
            
            switch(formType) {
                case 'goals':
                    const dailyCalls = form.querySelector('input[name="dailyCalls"]').value;
                    const weeklyAppointments = form.querySelector('input[name="weeklyAppointments"]').value;
                    const monthlyClosings = form.querySelector('input[name="monthlyClosings"]').value;
                    
                    if (dailyCalls) dashboardData.goals.daily.calls = parseInt(dailyCalls);
                    if (weeklyAppointments) dashboardData.goals.weekly.appointments = parseInt(weeklyAppointments);
                    if (monthlyClosings) dashboardData.goals.monthly.closings = parseInt(monthlyClosings);
                    success = true;
                    break;
                    
                case 'properties':
                    const address = form.querySelector('input[name="address"]').value;
                    const client = form.querySelector('input[name="client"]').value;
                    const propertyType = form.querySelector('select[name="type"]').value;
                    const price = form.querySelector('input[name="price"]').value;
                    const status = form.querySelector('select[name="status"]').value;
                    const statusNote = form.querySelector('textarea[name="statusNote"]').value;
                    
                    if (address && price) {
                        const newProperty = {
                            id: Date.now(),
                            address: address,
                            client: client,
                            type: propertyType,
                            price: parseFloat(price),
                            status: status,
                            statusNote: statusNote
                        };
                        dashboardData.properties.push(newProperty);
                        success = true;
                    }
                    break;
                    
                case 'daily':
                    const date = form.querySelector('input[name="date"]').value;
                    const hours = form.querySelector('input[name="hours"]').value;
                    const calls = form.querySelector('input[name="calls"]').value;
                    const answered = form.querySelector('input[name="answered"]').value;
                    const appointments = form.querySelector('input[name="appointments"]').value;
                    const offers = form.querySelector('input[name="offers"]').value;
                    
                    if (date) {
                        dashboardData.dailyData[date] = {
                            hours: parseFloat(hours) || 0,
                            calls: parseInt(calls) || 0,
                            answered: parseInt(answered) || 0,
                            appointments: parseInt(appointments) || 0,
                            offers: parseInt(offers) || 0
                        };
                        success = true;
                    }
                    break;
                    
                case 'expenses':
                    const expDate = form.querySelector('input[name="date"]').value;
                    const category = form.querySelector('select[name="category"]').value;
                    const amount = form.querySelector('input[name="amount"]').value;
                    const description = form.querySelector('input[name="description"]').value;
                    const mileage = form.querySelector('input[name="mileage"]').value;
                    const travelHours = form.querySelector('input[name="travelHours"]').value;
                    
                    if (expDate && amount) {
                        const newExpense = {
                            id: Date.now(),
                            date: expDate,
                            category: category,
                            amount: parseFloat(amount),
                            description: description,
                            mileage: parseFloat(mileage) || 0,
                            travelHours: parseFloat(travelHours) || 0
                        };
                        dashboardData.expenses.push(newExpense);
                        success = true;
                    }
                    break;
                    
                case 'calendar':
                    const apptDate = form.querySelector('input[name="date"]').value;
                    const time = form.querySelector('input[name="time"]').value;
                    const apptClient = form.querySelector('input[name="client"]').value;
                    const type = form.querySelector('select[name="type"]').value;
                    
                    if (apptDate && time && apptClient) {
                        const newAppointment = {
                            id: Date.now(),
                            date: apptDate,
                            time: time,
                            client: apptClient,
                            type: type
                        };
                        dashboardData.appointments.push(newAppointment);
                        success = true;
                    }
                    break;
            }
            
            if (success) {
                saveData();
                updateDashboard();
                return true;
            }
            return false;
        }

        // Property management functions
        function editProperty(propertyId) {
            const property = dashboardData.properties.find(p => p.id === propertyId);
            if (!property) return;

            const row = event.target.closest('tr');
            const cells = row.querySelectorAll('td');
            
            // Store original values
            const originalData = {
                address: property.address,
                client: property.client,
                type: property.type || 'Seller',
                price: property.price,
                status: property.status,
                statusNote: property.statusNote || ''
            };

            // Replace cells with input fields
            cells[0].innerHTML = `<input type="text" value="${property.address}" style="width: 100%;">`;
            cells[1].innerHTML = `<input type="text" value="${property.client}" style="width: 100%;">`;
            cells[2].innerHTML = `
                <select style="width: 100%;">
                    <option value="Buyer" ${property.type === 'Buyer' ? 'selected' : ''}>Buyer</option>
                    <option value="Seller" ${property.type === 'Seller' || !property.type ? 'selected' : ''}>Seller</option>
                </select>
            `;
            cells[3].innerHTML = `<input type="number" value="${property.price}" style="width: 100%;">`;
            cells[4].innerHTML = `
                <select style="width: 100%;">
                    <option value="Active" ${property.status === 'Active' ? 'selected' : ''}>Active</option>
                    <option value="Pending" ${property.status === 'Pending' ? 'selected' : ''}>Pending</option>
                    <option value="Sold" ${property.status === 'Sold' ? 'selected' : ''}>Sold</option>
                    <option value="Expired" ${property.status === 'Expired' ? 'selected' : ''}>Expired</option>
                    <option value="Withdrawn" ${property.status === 'Withdrawn' ? 'selected' : ''}>Withdrawn</option>
                    <option value="Terminated" ${property.status === 'Terminated' ? 'selected' : ''}>Terminated</option>
                </select>
            `;
            cells[5].innerHTML = `<textarea style="width: 100%; height: 60px;">${property.statusNote || ''}</textarea>`;
            cells[6].innerHTML = `
                <button class="action-btn save-btn" onclick="saveProperty(${propertyId})">Save</button>
                <button class="action-btn cancel-btn" onclick="cancelEdit(${propertyId})">Cancel</button>
            `;
            
            // Store original data on the row for cancel functionality
            row.dataset.originalData = JSON.stringify(originalData);
        }

        function saveProperty(propertyId) {
            const row = event.target.closest('tr');
            const cells = row.querySelectorAll('td');
            
            const newAddress = cells[0].querySelector('input').value;
            const newClient = cells[1].querySelector('input').value;
            const newType = cells[2].querySelector('select').value;
            const newPrice = parseFloat(cells[3].querySelector('input').value);
            const newStatus = cells[4].querySelector('select').value;
            const newStatusNote = cells[5].querySelector('textarea').value;
            
            if (!newAddress || !newPrice) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Update the property in dashboardData
            const propertyIndex = dashboardData.properties.findIndex(p => p.id === propertyId);
            if (propertyIndex !== -1) {
                dashboardData.properties[propertyIndex] = {
                    id: propertyId,
                    address: newAddress,
                    client: newClient,
                    type: newType,
                    price: newPrice,
                    status: newStatus,
                    statusNote: newStatusNote
                };
                
                saveData();
                updateDashboard();
                alert('Property updated successfully!');
            }
        }

        function cancelEdit(propertyId) {
            updatePropertiesDisplay();
        }

        function deleteProperty(propertyId) {
            const property = dashboardData.properties.find(p => p.id === propertyId);
            if (!property) return;
            
            if (confirm(`Are you sure you want to delete the property at ${property.address}?`)) {
                dashboardData.properties = dashboardData.properties.filter(p => p.id !== propertyId);
                saveData();
                updateDashboard();
                alert('Property deleted successfully!');
            }
        }

        // Expense management functions
        function calculateMileageCost() {
            const mileage = parseFloat(document.getElementById('expenseMileage').value) || 0;
            const gasPrice = parseFloat(document.getElementById('expenseGasPrice').value) || 0;
            const mpg = parseFloat(document.getElementById('expenseMPG').value) || 20;
            
            const mileageCost = (mileage / mpg) * gasPrice;
            document.getElementById('expenseMileageCost').value = mileageCost.toFixed(2);
        }

        function addExpense() {
            const date = document.getElementById('expenseDate').value;
            const property = document.getElementById('expenseProperty').value;
            const category = document.getElementById('expenseCategory').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const description = document.getElementById('expenseDescription').value;
            const mileage = parseFloat(document.getElementById('expenseMileage').value) || 0;
            const gasPrice = parseFloat(document.getElementById('expenseGasPrice').value) || 0;
            const mpg = parseFloat(document.getElementById('expenseMPG').value) || 20;
            const mileageCost = parseFloat(document.getElementById('expenseMileageCost').value) || 0;
            const travelHours = parseFloat(document.getElementById('expenseTravelHours').value) || 0;
            const hoursWorked = parseFloat(document.getElementById('expenseHoursWorked').value) || 0;
            const hourlyRate = parseFloat(document.getElementById('expenseHourlyRate').value) || 0;

            if (!date || !category || !amount || !description) {
                alert('Please fill in all required fields (Date, Category, Amount, Description)');
                return;
            }

            const newExpense = {
                id: Date.now(),
                date: date,
                property: property,
                category: category,
                amount: amount,
                description: description,
                mileage: mileage,
                gasPrice: gasPrice,
                mpg: mpg,
                mileageCost: mileageCost,
                travelHours: travelHours,
                hoursWorked: hoursWorked,
                hourlyRate: hourlyRate
            };

            dashboardData.expenses.push(newExpense);
            saveData();
            updateDashboard();

            // Clear form
            document.getElementById('expenseDate').value = '';
            document.getElementById('expenseProperty').value = '';
            document.getElementById('expenseCategory').value = 'Marketing';
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseDescription').value = '';
            document.getElementById('expenseMileage').value = '';
            document.getElementById('expenseGasPrice').value = '';
            document.getElementById('expenseMPG').value = '20';
            document.getElementById('expenseMileageCost').value = '';
            document.getElementById('expenseTravelHours').value = '';
            document.getElementById('expenseHoursWorked').value = '';
            document.getElementById('expenseHourlyRate').value = '';

            alert('Expense added successfully!');
        }

        function editExpense(expenseId) {
            const expense = dashboardData.expenses.find(e => e.id === expenseId);
            if (!expense) return;
            
            const row = event.target.closest('tr');
            const cells = row.querySelectorAll('td');
            
            // Store original values
            const originalValues = {
                date: expense.date,
                property: expense.property,
                category: expense.category,
                amount: expense.amount,
                description: expense.description,
                mileage: expense.mileage,
                travelHours: expense.travelHours,
                hoursWorked: expense.hoursWorked
            };
            
            // Create property dropdown HTML
            let propertyOptions = '<option value="">Select Property (Optional)</option>';
            dashboardData.properties.forEach(property => {
                const selected = property.address === expense.property ? 'selected' : '';
                propertyOptions += `<option value="${property.address}" ${selected}>${property.address}</option>`;
            });
            
            // Create category dropdown HTML
            const categories = ['Marketing', 'Meals', 'Professional Photography', 'Staging', 'Junk Removal', 'Cleaner', 'Mileage', 'Equipment Rental', 'Office', 'Professional Development', 'Appraisal', 'Office Meeting'];
            let categoryOptions = '';
            categories.forEach(cat => {
                const selected = cat === expense.category ? 'selected' : '';
                categoryOptions += `<option value="${cat}" ${selected}>${cat}</option>`;
            });
            
            // Replace cells with input fields
            cells[0].innerHTML = `<input type="date" value="${expense.date}" style="width: 100%;">`;
            cells[1].innerHTML = `<select style="width: 100%;">${propertyOptions}</select>`;
            cells[2].innerHTML = `<select style="width: 100%;">${categoryOptions}</select>`;
            cells[3].innerHTML = `<input type="number" value="${expense.amount}" step="0.01" style="width: 100%;">`;
            cells[4].innerHTML = `<input type="text" value="${expense.description}" style="width: 100%;">`;
            cells[5].innerHTML = `<input type="number" value="${expense.mileage || 0}" step="0.1" style="width: 100%;">`;
            cells[6].innerHTML = `<input type="number" value="${expense.gasPrice || 0}" step="0.01" style="width: 100%;">`;
            cells[7].innerHTML = `<input type="number" value="${expense.mpg || 20}" step="0.1" style="width: 100%;">`;
            cells[8].innerHTML = `<input type="number" value="${expense.mileageCost || 0}" step="0.01" style="width: 100%;" readonly>`;
            cells[9].innerHTML = `<input type="number" value="${expense.travelHours || 0}" step="0.25" style="width: 100%;">`;
            cells[10].innerHTML = `<input type="number" value="${expense.hoursWorked || 0}" step="0.25" style="width: 100%;">`;
            cells[11].innerHTML = `<input type="number" value="${expense.hourlyRate || 0}" step="0.01" style="width: 100%;">`;
            cells[12].innerHTML = `
                <button class="action-btn save-btn" onclick="saveExpense(${expenseId})">Save</button>
                <button class="action-btn cancel-btn" onclick="cancelExpenseEdit(${expenseId})">Cancel</button>
            `;
            
            // Store original values for cancel function
            row.dataset.originalValues = JSON.stringify(originalValues);
        }

        function saveExpense(expenseId) {
            const expense = dashboardData.expenses.find(e => e.id === expenseId);
            if (!expense) return;
            
            const row = event.target.closest('tr');
            const inputs = row.querySelectorAll('input, select');
            
            // Validate required fields
            if (!inputs[0].value || !inputs[2].value || !inputs[3].value || !inputs[4].value) {
                alert('Please fill in all required fields (Date, Category, Amount, Description)');
                return;
            }
            
            // Update expense object
            expense.date = inputs[0].value;
            expense.property = inputs[1].value;
            expense.category = inputs[2].value;
            expense.amount = parseFloat(inputs[3].value);
            expense.description = inputs[4].value;
            expense.mileage = parseFloat(inputs[5].value) || 0;
            expense.gasPrice = parseFloat(inputs[6].value) || 0;
            expense.mpg = parseFloat(inputs[7].value) || 20;
            expense.mileageCost = parseFloat(inputs[8].value) || 0;
            expense.travelHours = parseFloat(inputs[9].value) || 0;
            expense.hoursWorked = parseFloat(inputs[10].value) || 0;
            expense.hourlyRate = parseFloat(inputs[11].value) || 0;
            
            saveData();
            updateDashboard();
            alert('Expense updated successfully!');
        }

        function cancelExpenseEdit(expenseId) {
            updateExpensesDisplay();
        }

        function deleteExpense(expenseId) {
            const expense = dashboardData.expenses.find(e => e.id === expenseId);
            if (!expense) return;
            
            if (confirm(`Are you sure you want to delete the expense: ${expense.description}?`)) {
                dashboardData.expenses = dashboardData.expenses.filter(e => e.id !== expenseId);
                saveData();
                updateDashboard();
                alert('Expense deleted successfully!');
            }
        }

        // Property expense viewing functions
        function viewPropertyExpenses(propertyAddress) {
            const propertyExpenses = dashboardData.expenses.filter(expense => expense.property === propertyAddress);
            const modal = document.getElementById('propertyExpenseModal');
            const title = document.getElementById('propertyExpenseTitle');
            const details = document.getElementById('propertyExpenseDetails');
            
            title.textContent = `Expense Details for ${propertyAddress}`;
            
            if (propertyExpenses.length === 0) {
                details.innerHTML = '<p>No expenses found for this property.</p>';
            } else {
                let totalAmount = 0;
                let totalMileage = 0;
                let totalTravelHours = 0;
                let totalHoursWorked = 0;
                
                let tableHTML = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Category</th>
                                <th>Amount</th>
                                <th>Description</th>
                                <th>Mileage</th>
                                <th>Gas Price</th>
                                <th>Travel Hours</th>
                                <th>Hours Worked</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                propertyExpenses.forEach(expense => {
                    totalAmount += expense.amount;
                    totalMileage += expense.mileage || 0;
                    totalTravelHours += expense.travelHours || 0;
                    totalHoursWorked += expense.hoursWorked || 0;
                    
                    tableHTML += `
                        <tr>
                            <td>${expense.date}</td>
                            <td>${expense.category}</td>
                            <td>$${expense.amount.toLocaleString()}</td>
                            <td>${expense.description}</td>
                            <td>${expense.mileage || 0} miles</td>
                            <td>$${(expense.gasPrice || 0).toFixed(2)}</td>
                            <td>${expense.travelHours || 0} hrs</td>
                            <td>${expense.hoursWorked || 0} hrs</td>
                        </tr>
                    `;
                });
                
                tableHTML += `
                        </tbody>
                    </table>
                    <div class="expense-summary">
                        <h4>Summary</h4>
                        <div><strong>Total Amount:</strong> $${totalAmount.toLocaleString()}</div>
                        <div><strong>Total Mileage:</strong> ${totalMileage.toFixed(1)} miles</div>
                        <div><strong>Total Travel Hours:</strong> ${totalTravelHours.toFixed(1)} hrs</div>
                        <div><strong>Total Hours Worked:</strong> ${totalHoursWorked.toFixed(1)} hrs</div>
                        <div><strong>Number of Expenses:</strong> ${propertyExpenses.length}</div>
                    </div>
                `;
                
                details.innerHTML = tableHTML;
            }
            
            modal.style.display = 'block';
        }

        function closePropertyExpenseModal() {
            document.getElementById('propertyExpenseModal').style.display = 'none';
        }

        // Activity management functions
        function addActivity() {
            const date = document.getElementById('activityDate').value;
            const type = document.getElementById('activityType').value;
            const client = document.getElementById('activityClient').value;
            const property = document.getElementById('activityProperty').value;
            const notes = document.getElementById('activityNotes').value;

            if (!date || !type || !client) {
                alert('Please fill in all required fields (Date, Type, Client)');
                return;
            }

            const newActivity = {
                id: Date.now(),
                date: date,
                type: type,
                client: client,
                property: property,
                notes: notes
            };

            dashboardData.activities.push(newActivity);
            saveData();
            updateDashboard();

            // Clear form
            document.getElementById('activityDate').value = '';
            document.getElementById('activityType').value = 'Property Showing';
            document.getElementById('activityClient').value = '';
            document.getElementById('activityProperty').value = '';
            document.getElementById('activityNotes').value = '';

            alert('Activity added successfully!');
        }

        function updateCalendarDisplay() {
            const activities = dashboardData.activities;
            const thisMonth = new Date().getMonth();
            const thisYear = new Date().getFullYear();
            
            const monthlyActivities = activities.filter(activity => {
                const activityDate = new Date(activity.date);
                return activityDate.getMonth() === thisMonth && activityDate.getFullYear() === thisYear;
            });
            
            const showings = monthlyActivities.filter(a => a.type === 'Property Showing').length;
            const presentations = monthlyActivities.filter(a => a.type === 'Listing Presentation').length;
            const consultations = monthlyActivities.filter(a => a.type === 'Buyer Consultation').length;
            const closings = monthlyActivities.filter(a => a.type === 'Closing').length;

            const calCards = document.querySelectorAll('#calendar .card .number');
            if (calCards.length >= 4) {
                calCards[0].textContent = showings;
                calCards[1].textContent = presentations;
                calCards[2].textContent = consultations;
                calCards[3].textContent = closings;
            }

            // Update activities table
            const activitiesTableBody = document.querySelector('#activitiesTable tbody');
            if (activitiesTableBody) {
                activitiesTableBody.innerHTML = '';
                
                activities.forEach(activity => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${activity.date}</td>
                        <td>${activity.type}</td>
                        <td>${activity.client}</td>
                        <td>${activity.property || 'N/A'}</td>
                        <td>${activity.notes || 'N/A'}</td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editActivity(${activity.id})">Edit</button>
                            <button class="action-btn delete-btn" onclick="deleteActivity(${activity.id})">Delete</button>
                        </td>
                    `;
                    activitiesTableBody.appendChild(row);
                });
            }
        }

        function editActivity(activityId) {
            // Similar to editExpense but for activities
            const activity = dashboardData.activities.find(a => a.id === activityId);
            if (!activity) return;
            
            const row = event.target.closest('tr');
            const cells = row.querySelectorAll('td');
            
            const activityTypes = ['Property Showing', 'Listing Presentation', 'Buyer Consultation', 'Closing', 'Open House', 'Property Inspection', 'Market Analysis'];
            let typeOptions = '';
            activityTypes.forEach(type => {
                const selected = type === activity.type ? 'selected' : '';
                typeOptions += `<option value="${type}" ${selected}>${type}</option>`;
            });
            
            cells[0].innerHTML = `<input type="date" value="${activity.date}" style="width: 100%;">`;
            cells[1].innerHTML = `<select style="width: 100%;">${typeOptions}</select>`;
            cells[2].innerHTML = `<input type="text" value="${activity.client}" style="width: 100%;">`;
            cells[3].innerHTML = `<input type="text" value="${activity.property || ''}" style="width: 100%;">`;
            cells[4].innerHTML = `<input type="text" value="${activity.notes || ''}" style="width: 100%;">`;
            cells[5].innerHTML = `
                <button class="action-btn save-btn" onclick="saveActivity(${activityId})">Save</button>
                <button class="action-btn cancel-btn" onclick="cancelActivityEdit(${activityId})">Cancel</button>
            `;
        }

        function saveActivity(activityId) {
            const activity = dashboardData.activities.find(a => a.id === activityId);
            if (!activity) return;
            
            const row = event.target.closest('tr');
            const inputs = row.querySelectorAll('input, select');
            
            if (!inputs[0].value || !inputs[1].value || !inputs[2].value) {
                alert('Please fill in all required fields (Date, Type, Client)');
                return;
            }
            
            activity.date = inputs[0].value;
            activity.type = inputs[1].value;
            activity.client = inputs[2].value;
            activity.property = inputs[3].value;
            activity.notes = inputs[4].value;
            
            saveData();
            updateDashboard();
            alert('Activity updated successfully!');
        }

        function cancelActivityEdit(activityId) {
            updateCalendarDisplay();
        }

        function deleteActivity(activityId) {
            const activity = dashboardData.activities.find(a => a.id === activityId);
            if (!activity) return;
            
            if (confirm(`Are you sure you want to delete this activity: ${activity.type} with ${activity.client}?`)) {
                dashboardData.activities = dashboardData.activities.filter(a => a.id !== activityId);
                saveData();
                updateDashboard();
                alert('Activity deleted successfully!');
            }
        }

        // Fix GCI Calculator
        function calculateGCI() {
            const avgPrice = parseFloat(document.getElementById('avgPrice').value) || 0;
            const commissionRate = parseFloat(document.getElementById('commissionRate').value) || 0;
            const gciGoal = parseFloat(document.getElementById('gciGoal').value) || 0;
            
            if (avgPrice === 0 || commissionRate === 0 || gciGoal === 0) {
                alert('Please fill in all fields');
                return;
            }
            
            const commissionPerDeal = (avgPrice * commissionRate) / 100;
            const dealsNeeded = Math.ceil(gciGoal / commissionPerDeal);
            
            document.getElementById('dealsNeeded').value = dealsNeeded;
            
            // Update the GCI cards
            const gciCards = document.querySelectorAll('#gci .card .number');
            if (gciCards.length >= 4) {
                gciCards[0].textContent = '$' + (gciGoal / 1000) + 'K';
                gciCards[1].textContent = '$' + (dashboardData.transactions.reduce((sum, t) => sum + t.commission, 0) / 1000) + 'K';
                gciCards[2].textContent = '$' + ((gciGoal - dashboardData.transactions.reduce((sum, t) => sum + t.commission, 0)) / 1000) + 'K';
                gciCards[3].textContent = Math.round((dashboardData.transactions.reduce((sum, t) => sum + t.commission, 0) / gciGoal) * 100) + '%';
            }
            
            // Update dashboard data
            dashboardData.goals.annual.gci = gciGoal;
            saveData();
            updateDashboard();
        }

        // Initialize dashboard
        function initializeDashboard() {
            loadData();
            updateDashboard();
            
            // Add form event listeners
            document.querySelectorAll('.btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const form = this.closest('.form-section');
                    if (form) {
                        // Determine form type based on parent tab
                        const parentTab = form.closest('.tab-content');
                        let formType = '';
                        if (parentTab) {
                            formType = parentTab.id;
                        }
                        
                        // Handle the form submission
                        if (handleFormSubmission(formType, form)) {
                            alert('Data saved successfully!');
                            // Clear form inputs
                            const inputs = form.querySelectorAll('input[type="text"], input[type="number"], select');
                            inputs.forEach(input => {
                                if (input.type !== 'date') {
                                    input.value = '';
                                }
                            });
                        } else {
                            alert('Please fill in all required fields.');
                        }
                    }
                });
            });
        }

        // Expense tile toggle functionality
        function toggleExpenseTile(tileId) {
            const tile = document.getElementById(tileId);
            const checkbox = document.getElementById('show' + tileId.charAt(0).toUpperCase() + tileId.slice(1));
            
            if (checkbox.checked) {
                tile.style.display = 'block';
            } else {
                tile.style.display = 'none';
            }
        }

        // Report generation functionality
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const fromDate = document.getElementById('reportFromDate').value;
            const toDate = document.getElementById('reportToDate').value;
            
            if (!fromDate || !toDate) {
                alert('Please select both From and To dates for the report');
                return;
            }
            
            if (new Date(fromDate) > new Date(toDate)) {
                alert('From date must be before To date');
                return;
            }
            
            let reportContent = '';
            const startDate = new Date(fromDate);
            const endDate = new Date(toDate);
            
            // Filter data based on date range
            const filteredExpenses = dashboardData.expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate >= startDate && expenseDate <= endDate;
            });
            
            const filteredTransactions = dashboardData.transactions.filter(transaction => {
                const transactionDate = new Date(transaction.date);
                return transactionDate >= startDate && transactionDate <= endDate;
            });
            
            const filteredOffers = dashboardData.offersWritten.filter(offer => {
                const offerDate = new Date(offer.date);
                return offerDate >= startDate && offerDate <= endDate;
            });
            
            // Generate report based on type
            if (reportType === 'weekly') {
                reportContent = generateWeeklyReport(filteredExpenses, filteredTransactions, filteredOffers, startDate, endDate);
            } else if (reportType === 'monthly') {
                reportContent = generateMonthlyReport(filteredExpenses, filteredTransactions, filteredOffers, startDate, endDate);
            } else if (reportType === 'expense') {
                reportContent = generateExpenseReport(filteredExpenses, startDate, endDate);
            } else if (reportType === 'commission') {
                reportContent = generateCommissionReport(filteredTransactions, startDate, endDate);
            } else {
                reportContent = generateGenericReport(reportType, startDate, endDate);
            }
            
            // Display report in a new window
            displayReport(reportContent, reportType);
        }

        function generateWeeklyReport(expenses, transactions, offers, startDate, endDate) {
            const totalExpenses = expenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
            const totalCommissions = transactions.reduce((sum, transaction) => sum + parseFloat(transaction.commission), 0);
            const totalOffers = offers.length;
            const totalMileage = expenses.reduce((sum, expense) => sum + parseFloat(expense.mileage || 0), 0);
            const totalHours = expenses.reduce((sum, expense) => sum + parseFloat(expense.hoursWorked || 0), 0);
            
            const categoryBreakdown = {};
            expenses.forEach(expense => {
                if (!categoryBreakdown[expense.category]) {
                    categoryBreakdown[expense.category] = 0;
                }
                categoryBreakdown[expense.category] += parseFloat(expense.amount);
            });
            
            let report = `
                <h2>Weekly Summary Report</h2>
                <h3>${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()}</h3>
                <div class="report-section">
                    <h4>Overview</h4>
                    <p>Total Expenses: $${totalExpenses.toFixed(2)}</p>
                    <p>Total Commissions: $${totalCommissions.toFixed(2)}</p>
                    <p>Offers Written: ${totalOffers}</p>
                    <p>Total Mileage: ${totalMileage.toFixed(1)} miles</p>
                    <p>Total Hours Worked: ${totalHours.toFixed(1)} hours</p>
                </div>
                <div class="report-section">
                    <h4>Expense Breakdown by Category</h4>
            `;
            
            for (const [category, amount] of Object.entries(categoryBreakdown)) {
                report += `<p>${category}: $${amount.toFixed(2)}</p>`;
            }
            
            report += `</div>`;
            
            if (transactions.length > 0) {
                report += `<div class="report-section">
                    <h4>Transactions</h4>`;
                transactions.forEach(transaction => {
                    report += `<p>${transaction.date}: ${transaction.property} - $${transaction.amount.toLocaleString()} (Commission: $${transaction.commission.toFixed(2)})</p>`;
                });
                report += `</div>`;
            }
            
            return report;
        }

        function generateMonthlyReport(expenses, transactions, offers, startDate, endDate) {
            const totalExpenses = expenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
            const totalCommissions = transactions.reduce((sum, transaction) => sum + parseFloat(transaction.commission), 0);
            const totalOffers = offers.length;
            const totalMileage = expenses.reduce((sum, expense) => sum + parseFloat(expense.mileage || 0), 0);
            const totalHours = expenses.reduce((sum, expense) => sum + parseFloat(expense.hoursWorked || 0), 0);
            
            const categoryBreakdown = {};
            expenses.forEach(expense => {
                if (!categoryBreakdown[expense.category]) {
                    categoryBreakdown[expense.category] = 0;
                }
                categoryBreakdown[expense.category] += parseFloat(expense.amount);
            });
            
            let report = `
                <h2>Monthly Summary Report</h2>
                <h3>${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()}</h3>
                <div class="report-section">
                    <h4>Overview</h4>
                    <p>Total Expenses: $${totalExpenses.toFixed(2)}</p>
                    <p>Total Commissions: $${totalCommissions.toFixed(2)}</p>
                    <p>Offers Written: ${totalOffers}</p>
                    <p>Total Mileage: ${totalMileage.toFixed(1)} miles</p>
                    <p>Total Hours Worked: ${totalHours.toFixed(1)} hours</p>
                    <p>Net Income: $${(totalCommissions - totalExpenses).toFixed(2)}</p>
                </div>
                <div class="report-section">
                    <h4>Expense Breakdown by Category</h4>
            `;
            
            for (const [category, amount] of Object.entries(categoryBreakdown)) {
                report += `<p>${category}: $${amount.toFixed(2)}</p>`;
            }
            
            report += `</div>`;
            
            if (transactions.length > 0) {
                report += `<div class="report-section">
                    <h4>Transactions</h4>`;
                transactions.forEach(transaction => {
                    report += `<p>${transaction.date}: ${transaction.property} - $${transaction.amount.toLocaleString()} (Commission: $${transaction.commission.toFixed(2)})</p>`;
                });
                report += `</div>`;
            }
            
            return report;
        }

        function generateCommissionReport(transactions, startDate, endDate) {
            const totalCommissions = transactions.reduce((sum, transaction) => sum + parseFloat(transaction.commission), 0);
            const totalSales = transactions.reduce((sum, transaction) => sum + parseFloat(transaction.amount), 0);
            
            let report = `
                <h2>Commission Report</h2>
                <h3>${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()}</h3>
                <div class="report-section">
                    <h4>Commission Summary</h4>
                    <p>Total Sales Volume: $${totalSales.toLocaleString()}</p>
                    <p>Total Commissions: $${totalCommissions.toFixed(2)}</p>
                    <p>Average Commission Rate: ${transactions.length > 0 ? ((totalCommissions / totalSales) * 100).toFixed(2) : 0}%</p>
                    <p>Number of Transactions: ${transactions.length}</p>
                </div>
                <div class="report-section">
                    <h4>Individual Transactions</h4>
            `;
            
            transactions.forEach(transaction => {
                const commissionRate = ((transaction.commission / transaction.amount) * 100).toFixed(2);
                report += `
                    <div style="margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                        <p><strong>${transaction.property}</strong></p>
                        <p>Date: ${transaction.date}</p>
                        <p>Sale Amount: $${transaction.amount.toLocaleString()}</p>
                        <p>Commission: $${transaction.commission.toFixed(2)} (${commissionRate}%)</p>
                    </div>
                `;
            });
            
            report += `</div>`;
            return report;
        }

        function generateExpenseReport(expenses, startDate, endDate) {
            const totalExpenses = expenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
            const totalMileage = expenses.reduce((sum, expense) => sum + parseFloat(expense.mileage || 0), 0);
            const totalMileageCost = expenses.reduce((sum, expense) => sum + parseFloat(expense.mileageCost || 0), 0);
            
            const propertyBreakdown = {};
            expenses.forEach(expense => {
                const property = expense.property || 'No Property';
                if (!propertyBreakdown[property]) {
                    propertyBreakdown[property] = { amount: 0, mileage: 0, hours: 0 };
                }
                propertyBreakdown[property].amount += parseFloat(expense.amount);
                propertyBreakdown[property].mileage += parseFloat(expense.mileage || 0);
                propertyBreakdown[property].hours += parseFloat(expense.hoursWorked || 0);
            });
            
            let report = `
                <h2>Expense Report</h2>
                <h3>${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()}</h3>
                <div class="report-section">
                    <h4>Total Summary</h4>
                    <p>Total Expenses: $${totalExpenses.toFixed(2)}</p>
                    <p>Total Mileage: ${totalMileage.toFixed(1)} miles</p>
                    <p>Total Mileage Cost: $${totalMileageCost.toFixed(2)}</p>
                </div>
                <div class="report-section">
                    <h4>Breakdown by Property</h4>
            `;
            
            for (const [property, data] of Object.entries(propertyBreakdown)) {
                report += `
                    <div style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                        <h5>${property}</h5>
                        <p>Amount: $${data.amount.toFixed(2)}</p>
                        <p>Mileage: ${data.mileage.toFixed(1)} miles</p>
                        <p>Hours: ${data.hours.toFixed(1)} hours</p>
                    </div>
                `;
            }
            
            report += `</div>`;
            return report;
        }

        function generateGenericReport(reportType, startDate, endDate) {
            return `
                <h2>${reportType.charAt(0).toUpperCase() + reportType.slice(1)} Report</h2>
                <h3>${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()}</h3>
                <div class="report-section">
                    <p>This report type is currently being developed.</p>
                    <p>Please check back later for detailed ${reportType} reporting.</p>
                </div>
            `;
        }

        function displayReport(content, reportType) {
            const reportWindow = window.open('', '_blank', 'width=800,height=600');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${reportType.charAt(0).toUpperCase() + reportType.slice(1)} Report</title>
                    <style>
                        body { 
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                            margin: 40px;
                            line-height: 1.6;
                        }
                        .report-section {
                            margin: 20px 0;
                            padding: 15px;
                            background: #f8f9fa;
                            border-radius: 8px;
                        }
                        h2 { color: #2c3e50; }
                        h3 { color: #34495e; }
                        h4 { color: #7f8c8d; }
                        h5 { color: #2c3e50; margin: 0 0 10px 0; }
                        p { margin: 5px 0; }
                        .button-container {
                            display: flex;
                            gap: 10px;
                            margin-top: 30px;
                            justify-content: center;
                        }
                        button {
                            padding: 10px 20px;
                            border: none;
                            border-radius: 5px;
                            cursor: pointer;
                            font-size: 14px;
                        }
                        .print-btn {
                            background: #3498db;
                            color: white;
                        }
                        .email-btn {
                            background: #27ae60;
                            color: white;
                        }
                        .close-btn {
                            background: #95a5a6;
                            color: white;
                        }
                        @media print {
                            body { margin: 20px; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    ${content}
                    <div class="no-print button-container">
                        <button class="print-btn" onclick="window.print()">Print Report</button>
                        <button class="email-btn" onclick="emailReport()">Email Report</button>
                        <button class="close-btn" onclick="window.close()">Close</button>
                    </div>
                    <script>
                        function emailReport() {
                            const subject = encodeURIComponent('${reportType.charAt(0).toUpperCase() + reportType.slice(1)} Report');
                            const body = encodeURIComponent('Please find attached the ${reportType} report.\\n\\nReport Content:\\n' + document.body.innerText);
                            const mailtoLink = 'mailto:?subject=' + subject + '&body=' + body;
                            window.location.href = mailtoLink;
                        }
                    </script>
                </body>
                </html>
            `);
            reportWindow.document.close();
        }

        // Theme toggle functionality
        function toggleTheme() {
            const body = document.body;
            const isDarkMode = body.classList.contains('dark-mode');
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (isDarkMode) {
                body.classList.remove('dark-mode');
                themeToggle.textContent = 'ðŸŒ™';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark-mode');
                themeToggle.textContent = 'â˜€ï¸';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Initialize theme on page load
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                body.classList.add('dark-mode');
                themeToggle.textContent = 'â˜€ï¸';
            } else {
                body.classList.remove('dark-mode');
                themeToggle.textContent = 'ðŸŒ™';
            }
        }

        // Start the dashboard when page loads
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Set current timestamp
                const timestampElement = document.getElementById('timestamp');
                if (timestampElement) {
                    timestampElement.textContent = new Date().toLocaleString();
                }
                
                // Set today's date in forms
                const dailyDateElement = document.getElementById('dailyDate');
                if (dailyDateElement) {
                    dailyDateElement.value = new Date().toISOString().split('T')[0];
                }
                
                const expenseDateElement = document.getElementById('expenseDate');
                if (expenseDateElement) {
                    expenseDateElement.value = new Date().toISOString().split('T')[0];
                }
                
                const activityDateElement = document.getElementById('activityDate');
                if (activityDateElement) {
                    activityDateElement.value = new Date().toISOString().split('T')[0];
                }
                
                initializeTheme();
                initializeDashboard();
            } catch (error) {
                console.error('Error initializing dashboard:', error);
            }
        });
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('propertyExpenseModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        };
    </script>
</body>
</html>
